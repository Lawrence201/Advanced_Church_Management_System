<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Church Finance</title>
    <link rel="stylesheet" href="../style.css">
</head>

<body>

    <style>
        /* Scrollable table for Expense Transactions */
        .eorp_exptablewrap {
            max-height: 100px;
            overflow-y: auto;
            scrollbar-width: thin;
            /* for Firefox */
            scrollbar-color: transparent transparent;
        }
    
        /* Hide scrollbar for Chrome, Edge, Safari */
        .eorp_exptablewrap::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
    
        /* Sticky table header */
        .eorp_exptable thead th {
            position: sticky;
            top: 0;
            z-index: 2;
            background: #e9eff6;
            /* light background for header */
            font-weight: 600;
            color: #1f2937;
        }
    
        /* Keep top section visible on scroll */
        .eorp_exphead {
            position: sticky;
            top: 0;
            z-index: 3;
    
        }
    
        /* Optional: make the search bar sticky too */
        .corp_searchcont {
            position: sticky;
            top: 64px;
            /* keeps it just below the header */
            z-index: 3;
            background: #fff;
            padding-top: 4px;
            padding-bottom: 8px;
        }
    
        /* Smooth scrolling */
        .eorp_exptablewrap {
            scroll-behavior: smooth;
        }
    
    
    
    
    
        /* Scrollable table for Welfare Contributors */
        .borp_cpstablewrap {
            max-height: 600px;
            overflow-y: auto;
            scrollbar-width: thin;
            /* for Firefox */
            scrollbar-color: transparent transparent;
        }
    
        /* Hide scrollbar for Chrome, Edge, Safari */
        .borp_cpstablewrap::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
    
        /* Sticky table header */
        .borp_cpstable thead th {
            position: sticky;
            top: 0;
            z-index: 2;
            background: #e9eff6;
            /* light header background */
            font-weight: 600;
            color: #1f2937;
        }
    
        /* Keep top header section visible on scroll */
        .borp_cpshead {
            position: sticky;
            top: 0;
            z-index: 3;
            background: #fff;
            padding-top: 8px;
        }
    
        /* Optional: Smooth scroll experience */
        .borp_cpstablewrap {
            scroll-behavior: smooth;
        }
    
    
    
    
    
        /* Scrollable table for CPS Contributors */
        .borp_cpstablewrap {
            max-height: 600px;
            overflow-y: auto;
            scrollbar-width: thin;
            /* for Firefox */
            scrollbar-color: transparent transparent;
        }
    
        /* Hide scrollbar for Chrome, Edge, Safari */
        .borp_cpstablewrap::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
    
        /* Sticky header effect */
        .borp_cpstable thead th {
            position: sticky;
            top: 0;
            z-index: 2;
            background: #e9eff6;
            /* light background for header */
            font-weight: 600;
            color: #1f2937;
        }
    
        /* Keep top section visible on scroll */
        .borp_cpshead {
            position: sticky;
            top: 0;
            z-index: 3;
            background: #fff;
            padding-top: 8px;
        }
    
    
    
    
    
    
    
        /* Scrollable table for Project Offering Records */
        .eorp_exptablewrap {
            max-height: 600px;
            overflow-y: auto;
            scrollbar-width: thin;
            /* for Firefox */
            scrollbar-color: transparent transparent;
        }
    
        /* Hide scrollbar for Chrome, Edge, Safari */
        .eorp_exptablewrap::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
    
        /* Sticky header effect */
        .eorp_exptable thead th {
            position: sticky;
            top: 0;
            z-index: 2;
            background: #e9eff6;
            /* light background for header */
    
            font-weight: 600;
            color: #1f2937;
        }
    
        /* Keep top section visible on scroll */
        .eorp_exphead {
            position: sticky;
            top: 0;
            z-index: 3;
            background: #fff;
            padding-top: 8px;
        }
    
    
    
    
    
    
    
    
    
    
    
        /* Scrollable offering table */
        .eorp_exptablewrap {
            max-height: 600px;
            overflow-y: auto;
            scrollbar-width: thin;
            /* for Firefox */
            scrollbar-color: transparent transparent;
        }
    
        /* Hide scrollbar for Chrome, Edge, Safari */
        .eorp_exptablewrap::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
    
        /* Sticky header for offering table */
        .eorp_exptable thead th {
            position: sticky;
            top: 0;
            z-index: 2;
            background: #e0e7ef;
            /* soft gray-blue background to match theme */
    
        }
    
        /* Optional: make header text stand out */
        .eorp_exptable thead th {
            font-weight: 600;
            color: #1f2937;
        }
    
        /* Keep the "Offering Records" top bar visible if page scrolls */
        .eorp_exphead {
            position: sticky;
            top: 0;
            z-index: 3;
    
        }
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
        /* Scrollable table wrapper */
        .cf-table-wrapper {
            max-height: 600px;
            overflow-y: auto;
            scrollbar-width: thin;
            /* for Firefox */
            scrollbar-color: transparent transparent;
    
        }
    
        /* Hide scrollbar (Chrome, Edge, Safari) */
        .cf-table-wrapper::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
    
        /* Sticky table header for transactions */
        .wump_txntable thead th {
            position: sticky;
            top: 0;
            z-index: 2;
            background: #d5dde5;
            border-bottom: 2px solid #eaeff5;
        }
    
        /* Fix top header (Recent Transactions bar) */
        .wump_txnhead {
            position: sticky;
            top: 0;
            z-index: 3;
    
        }
    </style>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
        
                <svg class="church-logo" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10 9h4" />
                    <path d="M12 7v5" />
                    <path d="M14 22v-4a2 2 0 0 0-4 0v4" />
                    <path
                        d="M18 22V5.618a1 1 0 0 0-.553-.894l-4.553-2.277a2 2 0 0 0-1.788 0L6.553 4.724A1 1 0 0 0 6 5.618V22" />
                    <path
                        d="m18 7 3.447 1.724a1 1 0 0 1 .553.894V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9.618a1 1 0 0 1 .553-.894L6 7" />
                </svg>
        
        
                <div class="logo-text">
                    <h3>Church</h3>
                    <p>Management System</p>
                </div>
        
                <!-- Close button for mobile -->
                <button class="sidebar-close" onclick="toggleSidebar()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        
            <div class="sidebar-content">
                <div class="menu-section">
                    <div class="menu-label">Main Menu</div>
                    <a href="../index.html" class="menu-item ">
                        <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-layout-dashboard h-5 w-5"
                                data-lov-id="src/components/AppSidebar.tsx:110:22" data-lov-name="item.icon"
                                data-component-path="src/components/AppSidebar.tsx" data-component-line="110"
                                data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <rect width="7" height="9" x="3" y="3" rx="1"></rect>
                                <rect width="7" height="5" x="14" y="3" rx="1"></rect>
                                <rect width="7" height="9" x="14" y="12" rx="1"></rect>
                                <rect width="7" height="5" x="3" y="16" rx="1"></rect>
                            </svg></span>
                        <span>Dashboard</span>
                    </a>
                    <a href="../Members/members.html" class="menu-item">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-users h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:110:22"
                                data-lov-name="item.icon" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="110" data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                        </span>
                        <span>Members</span>
                    </a>
                    <a href="../Members/visitors_management.html" class="menu-item">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-user-check h-5 w-5">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <polyline points="16 11 18 13 22 9"></polyline>
                            </svg>
                        </span>
                        <span>Visitors</span>
                    </a>
                    <a href="Events/events.html" class="menu-item">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-calendar h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:110:22"
                                data-lov-name="item.icon" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="110" data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M8 2v4"></path>
                                <path d="M16 2v4"></path>
                                <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                                <path d="M3 10h18"></path>
                            </svg>
                        </span>
                        <span>Events</span>
                    </a>
                    <a href="../Finance/finance.html" class="menu-item active">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-dollar-sign h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:110:22"
                                data-lov-name="item.icon" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="110" data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <line x1="12" x2="12" y1="2" y2="22"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </span>
                        <span>Finances</span>
                    </a>
                    <a href="../Communication/communication.html" class="menu-item">
                        <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-message-square h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:110:22"
                                data-lov-name="item.icon" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="110" data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                        </span>
                        <span>Communications</span>
                    </a>
                    <a href="../Attendance/attendance.html" class="menu-item">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-user-check h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:112:22"
                                data-lov-name="item.icon" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="112" data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <polyline points="16 11 18 13 22 9"></polyline>
                            </svg>
                        </span>
                        <span>Attendance</span>
                    </a>
                    <a href="../Report/report.html" class="menu-item">
                        <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-chart-column h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:110:22"
                                data-lov-name="item.icon" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="110" data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M3 3v16a2 2 0 0 0 2 2h16"></path>
                                <path d="M18 17V9"></path>
                                <path d="M13 17V5"></path>
                                <path d="M8 17v-3"></path>
                            </svg>
                        </span>
                        <span>Reports</span>
                    </a>
                </div>
        
                <div class="menu-section">
                    <div class="menu-label">AI Features</div>
                    <a href="../AI/ai_insight.html" class="menu-item has-badge">
                        <span>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L13.5 7.5H19L14.5 11L16 16.5L12 13L8 16.5L9.5 11L5 7.5H10.5L12 2Z"
                                    fill="currentColor" opacity="0.2" />
                                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5" />
                                <path d="M12 5V8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M12 16V19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M5 12H8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M16 12H19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M7.5 7.5L9.5 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M14.5 14.5L16.5 16.5" stroke="currentColor" stroke-width="1.5"
                                    stroke-linecap="round" />
                                <path d="M7.5 16.5L9.5 14.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M14.5 9.5L16.5 7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <circle cx="12" cy="5" r="1.5" fill="currentColor" />
                                <circle cx="19" cy="12" r="1.5" fill="currentColor" />
                                <circle cx="12" cy="19" r="1.5" fill="currentColor" />
                                <circle cx="5" cy="12" r="1.5" fill="currentColor" />
                            </svg>
        
                        </span>
                        <span>AI Insights</span>
                        <span class="badge">New</span>
                    </a>
                    <a href="../AI/members_analytics.html" class="menu-item has-badge">
                        <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-chart-column h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:131:22"
                                data-lov-name="item.icon" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="131" data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M3 3v16a2 2 0 0 0 2 2h16"></path>
                                <path d="M18 17V9"></path>
                                <path d="M13 17V5"></path>
                                <path d="M8 17v-3"></path>
                            </svg></span>
                        <span>Member Analytics</span>
                        <span class="badge">New</span>
                    </a>
                    <a href="../AI/ai_smart_report.html" class="menu-item has-badge">
                        <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-file-text h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:131:22"
                                data-lov-name="item.icon" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="131" data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
                                <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
                                <path d="M10 9H8"></path>
                                <path d="M16 13H8"></path>
                                <path d="M16 17H8"></path>
                            </svg></span>
                        <span>Smart Reports</span>
                        <span class="badge">New</span>
                    </a>
                </div>
        
                <div class="menu-section">
                    <div class="menu-label">Quick Actions</div>
                    <a href="../Add_Members/enroll_members.html" class="menu-item">
                        <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-user-plus h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:151:22"
                                data-lov-name="item.icon" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="151" data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <line x1="19" x2="19" y1="8" y2="14"></line>
                                <line x1="22" x2="16" y1="11" y2="11"></line>
                            </svg></span>
                        <span>Add Member</span>
                    </a>
                    <a href="../Add_Event/New_Event.html" class="menu-item">
                        <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-calendar h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:151:22"
                                data-lov-name="item.icon" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="151" data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M8 2v4"></path>
                                <path d="M16 2v4"></path>
                                <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                                <path d="M3 10h18"></path>
                            </svg></span>
                        <span>New Event</span>
                    </a>
                    <a href="../Record_Donations/record_donations.html" class="menu-item">
                        <span class="icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M20 10C20 6.5 17 4 14 4C12.5 4 11.2 4.6 10.3 5.6C9.9 5.2 9.4 5 8.8 5C7.3 5 6 6.3 6 7.8C6 8.4 6.2 8.9 6.5 9.3C4.5 10.2 3 12.2 3 14.5C3 17.5 5.5 20 8.5 20H16.5C19 20 21 18 21 15.5C21 13.2 19.5 11.3 17.5 10.5C18.4 10.8 19 11.7 19 12.7"
                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M12 20C11.4 20 9.5 19.5 8.5 19" stroke="currentColor" stroke-width="1.5"
                                    stroke-linecap="round" />
                                <circle cx="12" cy="8" r="1" fill="currentColor" />
                                <path d="M12 11V15M10 13H14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path
                                    d="M8.5 4C9.5 3 11 3 12 4C13 3 14.5 3 15.5 4C16 4.5 16 5.5 16 6C16 7 15 8 12 10C9 8 8 7 8 6C8 5.5 8 4.5 8.5 4Z"
                                    fill="currentColor" opacity="0.2" />
                                <path
                                    d="M12 5.5C10.5 4 9 4 8 5C7 6 7 7.5 7 8.5C7 10 8.5 11.5 12 14C15.5 11.5 17 10 17 8.5C17 7.5 17 6 16 5C15 4 13.5 4 12 5.5Z"
                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </span>
                        <span>Record Donation</span>
                    </a>
                    <a href="../Send_Message/send_message.html" class="menu-item">
                        <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-bell h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:151:22"
                                data-lov-name="item.icon" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="151" data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"></path>
                                <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"></path>
                            </svg></span>
                        <span>Send Message</span>
                    </a>
                </div>
        
                <div class="menu-section">
                    <div class="menu-label"></div>
                    <a href="../Settings/settings.html" class="menu-item">
                        <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="lucide lucide-settings h-5 w-5" data-lov-id="src/components/AppSidebar.tsx:166:18"
                                data-lov-name="Settings" data-component-path="src/components/AppSidebar.tsx"
                                data-component-line="166" data-component-file="AppSidebar.tsx" data-component-name="Settings"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path
                                    d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z">
                                </path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg></span>
                        <span>Settings</span>
                    </a>
        
                </div>
        
            </div>
        
        
        </div>


        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <button class="mobile-menu-toggle" onclick="toggleSidebar()">☰</button>
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="Search members, events, or anything...">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-search absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"
                        data-lov-id="src/components/Layout.tsx:24:16" data-lov-name="Search"
                        data-component-path="src/components/Layout.tsx" data-component-line="24"
                        data-component-file="Layout.tsx" data-component-name="Search"
                        data-component-content="%7B%22className%22%3A%22absolute%20left-3%20top-1%2F2%20transform%20-translate-y-1%2F2%20h-4%20w-4%20text-muted-foreground%22%7D">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.3-4.3"></path>
                    </svg>
                </div>
                <div class="header-right">
                    <div class="notification-icon">
                        <span style="font-size: 20px;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell h-5 w-5"
                                data-lov-id="src/components/AppSidebar.tsx:151:22" data-lov-name="item.icon"
                                data-component-path="src/components/AppSidebar.tsx" data-component-line="151"
                                data-component-file="AppSidebar.tsx" data-component-name="item.icon"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"></path>
                                <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"></path>
                            </svg>
                        </span>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="user-profile">
                        <span style="font-size: 14px; font-weight: 500;">Pastor Lawrence</span>
                        <span style="font-size: 20px;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user h-5 w-5"
                                data-lov-id="src/components/Layout.tsx:41:16" data-lov-name="User"
                                data-component-path="src/components/Layout.tsx" data-component-line="41"
                                data-component-file="Layout.tsx" data-component-name="User"
                                data-component-content="%7B%22className%22%3A%22h-5%20w-5%22%7D">
                                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                        </span>
                    </div>
                </div>
            </div>
            <script>
                function toggleSidebar() {
                    const sidebar = document.querySelector('.sidebar');
                    sidebar.classList.toggle('open');
                }

                // Close sidebar when clicking outside on mobile
                document.addEventListener('click', function (event) {
                    const sidebar = document.querySelector('.sidebar');
                    const toggle = document.querySelector('.mobile-menu-toggle');

                    if (window.innerWidth <= 768 &&
                        !sidebar.contains(event.target) &&
                        !toggle.contains(event.target) &&
                        sidebar.classList.contains('open')) {
                        sidebar.classList.remove('open');
                    }
                });
            </script>

            <!-- Dashboard Content -->
            <div class="dashboard-content">

                <!-- Main Header -->
                <div class="cf-header-primary">
                    <div class="cf-heading-zone">
                        <h1>Financial Management</h1>
                        <p>Track donations, expenses, and budgets with AI-powered insights</p>
                    </div>
                    <div class="cf-controls-cluster">
                        <button class="cf-btn cf-btn-alternate" onclick="exportMembers()">
                            <span><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7,10 12,15 17,10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg></span>
                            <span>Export Report</span>
                        </button>
                        <button class="cf-btn cf-btn-main" onclick="openAddMemberModal()">
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus h-4 w-4 mr-2"
                                    data-lov-id="src/pages/Finances.tsx:97:12" data-lov-name="Plus" data-component-path="src/pages/Finances.tsx"
                                    data-component-line="97" data-component-file="Finances.tsx" data-component-name="Plus"
                                    data-component-content="%7B%22className%22%3A%22h-4%20w-4%20mr-2%22%7D">
                                    <path d="M5 12h14"></path>
                                    <path d="M12 5v14"></path>
                                </svg>
                            </span>
                            <span>Record Donation</span>
                        </button>
                    </div>
                </div>
                
                <!-- Notification Cards -->
                <div class="insights-section">
                    <div class="insights-header">
                        <div class="insight-header-row">
                            <span class="insight-icon">
                                <img src="../Assests/chatbot.png" alt="AI Insights">
                            </span>
                            <h2>AI-Powered Insights</h2>
                        </div>
                
                
                
                        <div class="cf-alerts-layout">
                            <div class="cf-alert-tile cf-success">
                                <span class="cf-alert-symbol"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="green"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up h-4 w-4"
                                    data-lov-id="src/pages/Finances.tsx:110:18" data-lov-name="insight.icon"
                                    data-component-path="src/pages/Finances.tsx" data-component-line="110" data-component-file="Finances.tsx"
                                    data-component-name="insight.icon" data-component-content="%7B%22className%22%3A%22h-4%20w-4%22%7D">
                                    <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                                    <polyline points="16 7 22 7 22 13"></polyline>
                                </svg>
                                    </svg>
                                </span>
                                <div class="cf-alert-text">
                                    <h3>Donation Trend Positive</h3>
                                    <p>December donations exceeded budget by 6.4% - highest month this year</p>
                                </div>
                            </div>
                
                            <div class="cf-alert-tile cf-warning">
                                <span class="cf-alert-symbol"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="orange"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target h-4 w-4"
                                    data-lov-id="src/pages/Finances.tsx:110:18" data-lov-name="insight.icon"
                                    data-component-path="src/pages/Finances.tsx" data-component-line="110" data-component-file="Finances.tsx"
                                    data-component-name="insight.icon" data-component-content="%7B%22className%22%3A%22h-4%20w-4%22%7D">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <circle cx="12" cy="12" r="6"></circle>
                                    <circle cx="12" cy="12" r="2"></circle>
                                </svg></span>
                                <div class="cf-alert-text">
                                    <h3>Budget Performance</h3>
                                    <p>You're on track to meet 98% of your annual budget goals</p>
                                </div>
                            </div>
                
                            <div class="cf-alert-tile">
                                <span class="cf-alert-symbol">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="blue"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-alert h-4 w-4"
                                        data-lov-id="src/pages/Finances.tsx:110:18" data-lov-name="insight.icon"
                                        data-component-path="src/pages/Finances.tsx" data-component-line="110" data-component-file="Finances.tsx"
                                        data-component-name="insight.icon" data-component-content="%7B%22className%22%3A%22h-4%20w-4%22%7D">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="12" x2="12" y1="8" y2="12"></line>
                                        <line x1="12" x2="12.01" y1="16" y2="16"></line>
                                    </svg>
                                   
                                </span>
                                <div class="cf-alert-text">
                                    <h3>Expense Alert</h3>
                                    <p>Utilities costs increased 15% this quarter - consider energy audit</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- Stats Cards -->
                <section class="zzamp_statsarea">
                    <div class="zorp_container">
                        <div class="zzamp_statsgrid">
                            <!-- Card 1 -->
                            <div class="zzamp_statcard zzamp_cardblue">
                                <div class="zzamp_stathead">
                                    <span class="zzamp_stattitle">Total Offerings</span>
                                    <div class="zzamp_staticon zzamp_iconblue">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#5B4FDE"
                                                font-size="18" font-weight="bold">₵</text>
                                        </svg>
                                    </div>
                                </div>
                                <div class="zzamp_statval" id="topOfferingsTotal">₵0.00</div>
                                <div class="zzamp_statchg" id="topOfferingsChange">+0% from last month</div>
                            </div>

                            <!-- Card 2 -->
                            <div class="zzamp_statcard zzamp_cardgreen">
                                <div class="zzamp_stathead">
                                    <span class="zzamp_stattitle">Total Tithes</span>
                                    <div class="zzamp_staticon zzamp_icongreen">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                            <path d="M13 7L19 13M19 13L13 19M19 13H5" stroke="#10B981" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="zzamp_statval" id="topTithesTotal">₵0.00</div>
                                <div class="zzamp_statchg" id="topTithesChange">+0% from last month</div>
                            </div>

                            <!-- Card 3 -->
                            <div class="zzamp_statcard zzamp_cardyellow">
                                <div class="zzamp_stathead">
                                    <span class="zzamp_stattitle">Project Offerings</span>
                                    <div class="zzamp_staticon zzamp_iconyellow">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                            <rect x="5" y="5" width="14" height="14" rx="2" stroke="#F59E0B" stroke-width="2" />
                                            <path d="M9 9H15M9 12H15M9 15H12" stroke="#F59E0B" stroke-width="1.5"
                                                stroke-linecap="round" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="zzamp_statval" id="topProjectOfferingsTotal">₵0.00</div>
                                <div class="zzamp_statchg" id="topProjectOfferingsChange">+0% from last month</div>
                            </div>

                            <!-- Card 4 -->
                            <div class="zzamp_statcard zzamp_cardpink">
                                <div class="zzamp_stathead">
                                    <span class="zzamp_stattitle">Welfare Dues</span>
                                    <div class="zzamp_staticon zzamp_iconpink">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                            <path
                                                d="M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z"
                                                stroke="#E879F9" stroke-width="2" />
                                            <path d="M12 8V12L14.5 14.5" stroke="#E879F9" stroke-width="2" stroke-linecap="round" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="zzamp_statval" id="topWelfareTotal">₵0.00</div>
                                <div class="zzamp_statchg" id="topWelfareChange">+0% from last month</div>
                            </div>

                            <!-- Card 5 -->
                            <div class="zzamp_statcard zzamp_cardgray">
                                <div class="zzamp_stathead">
                                    <span class="zzamp_stattitle">Total Expenses</span>
                                    <div class="zzamp_staticon zzamp_icongray">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                            <circle cx="12" cy="12" r="9" stroke="#6B7280" stroke-width="2" />
                                            <path d="M12 8V12M12 16H12.01" stroke="#6B7280" stroke-width="2" stroke-linecap="round" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="zzamp_statval" id="topExpensesTotal">₵0.00</div>
                                <div class="zzamp_statchg" id="topExpensesChange">+0% from last month</div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Tabs Section -->
                <section class="qery_tabsarea">
                    <div class="zorp_container">
                        <div class="qery_tabsbar">
                            <div class="qery_tabslist">
                                <button class="qery_tab active">Overview</button>
                                <button class="qery_tab">Offerings</button>
                                <button class="qery_tab">Project Offering</button>
                                <button class="qery_tab">Tithes (CPS)</button>
                                <button class="qery_tab">Welfare</button>
                                <button class="qery_tab">Member Payments</button>
                                <button class="qery_tab">Expenses</button>
                            </div>
                            <button class="qery_filbtn">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M2 4H14M4 8H12M6 12H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                </svg>
                                Filter
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- Overview Content -->
                <div id="overviewContent" class="zump_contwrap active">
                    <!-- Charts Section -->
                    <section class="vorp_chartsarea">
                        <div class="zorp_container">
                            <div class="vorp_chartsgrid">
                                <!-- Financial Trends Chart -->
                                <div class="vorp_chartcard chart-large">
                                    <h3>Financial Trends (6 Months)</h3>
                                    <div class="vorp_chartcont" id="lineChartContainer">
                                        <svg class="vorp_chartsvg" viewBox="0 0 800 300" preserveAspectRatio="xMidYMid meet">
                                            <!-- Y-axis labels (will be updated by JS) -->
                                            <text x="40" y="30" class="vorp_axislab">₵0</text>
                                            <text x="40" y="95" class="vorp_axislab">₵0</text>
                                            <text x="40" y="160" class="vorp_axislab">₵0</text>
                                            <text x="40" y="225" class="vorp_axislab">₵0</text>
                                            <text x="40" y="285" class="vorp_axislab">₵0</text>

                                            <!-- X-axis labels (will be updated by JS for 6 months) -->
                                            <text x="150" y="285" class="vorp_axislab">Jul</text>
                                            <text x="250" y="285" class="vorp_axislab">Aug</text>
                                            <text x="350" y="285" class="vorp_axislab">Sep</text>
                                            <text x="450" y="285" class="vorp_axislab">Oct</text>
                                            <text x="550" y="285" class="vorp_axislab">Nov</text>
                                            <text x="650" y="285" class="vorp_axislab">Dec</text>

                                            <!-- Horizontal Grid lines -->
                                            <line x1="100" y1="20" x2="780" y2="20" stroke="#E5E7EB" stroke-width="1" />
                                            <line x1="100" y1="85" x2="780" y2="85" stroke="#E5E7EB" stroke-width="1" />
                                            <line x1="100" y1="150" x2="780" y2="150" stroke="#E5E7EB" stroke-width="1" />
                                            <line x1="100" y1="215" x2="780" y2="215" stroke="#E5E7EB" stroke-width="1" />

                                            <!-- Vertical Dashed Grid lines (6 months) -->
                                            <line x1="150" y1="20" x2="150" y2="275" stroke="#E5E7EB" stroke-width="1"
                                                stroke-dasharray="4,4" opacity="0.5" />
                                            <line x1="250" y1="20" x2="250" y2="275" stroke="#E5E7EB" stroke-width="1"
                                                stroke-dasharray="4,4" opacity="0.5" />
                                            <line x1="350" y1="20" x2="350" y2="275" stroke="#E5E7EB" stroke-width="1"
                                                stroke-dasharray="4,4" opacity="0.5" />
                                            <line x1="450" y1="20" x2="450" y2="275" stroke="#E5E7EB" stroke-width="1"
                                                stroke-dasharray="4,4" opacity="0.5" />
                                            <line x1="550" y1="20" x2="550" y2="275" stroke="#E5E7EB" stroke-width="1"
                                                stroke-dasharray="4,4" opacity="0.5" />
                                            <line x1="650" y1="20" x2="650" y2="275" stroke="#E5E7EB" stroke-width="1"
                                                stroke-dasharray="4,4" opacity="0.5" />

                                            <!-- Hover indicator line (will be shown via JS) -->
                                            <line id="hoverLine" x1="0" y1="20" x2="0" y2="275" stroke="#9CA3AF" stroke-width="1.5"
                                                stroke-dasharray="6,3" opacity="0" />

                                            <!-- Total Income Line (Green) - will be updated by JS -->
                                            <polyline class="vorp_line income" points="150,275 250,275 350,275 450,275 550,275 650,275"
                                                fill="none" stroke="#10B981" stroke-width="2.5" />

                                            <!-- Income dots (6 months) - will be updated by JS -->
                                            <circle class="vorp_dot" cx="150" cy="275" r="4" fill="white" stroke="#10B981"
                                                stroke-width="2.5" data-month="Month1" />
                                            <circle class="vorp_dot" cx="250" cy="275" r="4" fill="white" stroke="#10B981"
                                                stroke-width="2.5" data-month="Month2" />
                                            <circle class="vorp_dot" cx="350" cy="275" r="4" fill="white" stroke="#10B981"
                                                stroke-width="2.5" data-month="Month3" />
                                            <circle class="vorp_dot" cx="450" cy="275" r="4" fill="white" stroke="#10B981"
                                                stroke-width="2.5" data-month="Month4" />
                                            <circle class="vorp_dot" cx="550" cy="275" r="4" fill="white" stroke="#10B981"
                                                stroke-width="2.5" data-month="Month5" />
                                            <circle class="vorp_dot" cx="650" cy="275" r="4" fill="white" stroke="#10B981"
                                                stroke-width="2.5" data-month="Month6" />

                                            <!-- Total Expenses Line (Red) - will be updated by JS -->
                                            <polyline class="vorp_line expense" points="150,275 250,275 350,275 450,275 550,275 650,275"
                                                fill="none" stroke="#EF4444" stroke-width="2.5" />

                                            <!-- Expense dots (6 months) - will be updated by JS -->
                                            <circle class="vorp_dot" cx="150" cy="275" r="4" fill="white" stroke="#EF4444"
                                                stroke-width="2.5" data-month="Month1" />
                                            <circle class="vorp_dot" cx="250" cy="275" r="4" fill="white" stroke="#EF4444"
                                                stroke-width="2.5" data-month="Month2" />
                                            <circle class="vorp_dot" cx="350" cy="275" r="4" fill="white" stroke="#EF4444"
                                                stroke-width="2.5" data-month="Month3" />
                                            <circle class="vorp_dot" cx="450" cy="275" r="4" fill="white" stroke="#EF4444"
                                                stroke-width="2.5" data-month="Month4" />
                                            <circle class="vorp_dot" cx="550" cy="275" r="4" fill="white" stroke="#EF4444"
                                                stroke-width="2.5" data-month="Month5" />
                                            <circle class="vorp_dot" cx="650" cy="275" r="4" fill="white" stroke="#EF4444"
                                                stroke-width="2.5" data-month="Month6" />
                                        </svg>
                                        <div class="vorp_tooltip" id="chartTooltip"></div>
                
                                        <!-- Legend -->
                                        <div class="vorp_chartleg">
                                            <div class="vorp_legitem">
                                                <span class="vorp_legdot green"></span>
                                                <span>Total Income</span>
                                            </div>
                                            <div class="vorp_legitem">
                                                <span class="vorp_legdot red"></span>
                                                <span>Total Expenses</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                
                                <!-- Finance Categories Chart -->
                                <div class="vorp_chartcard chart-small">
                                    <h3>Finance Categories</h3>
                                    <p class="vorp_sub">December 2025 breakdown</p>
                                    <div class="vorp_piecont" style="margin-top: 20px;">
                                        <canvas id="categoriesChart" style="max-height: 280px;"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                
                    <!-- Recent Transactions Section -->
                    <section class="wump_txnarea">
                        <div class="zorp_container">
                            <div class="wump_txncard">
                                <div class="wump_txnhead">
                                    <div>
                                        <h3>Recent Transactions</h3>
                                    </div>
                                    <button class="wump_viewall">View All</button>
                                </div>
                    
                                <!-- Scrollable Table Wrapper -->
                                <div class="wump_txntablewrap">
                                    <div class="cf-table-wrapper">
                                        <table class="wump_txntable">
                                            <thead>
                                                <tr>
                                                    <th>Transaction ID</th>
                                                    <th>Date</th>
                                                    <th>Type</th>
                                                    <th>Member/Description</th>
                                                    <th>Category</th>
                                                    <th>Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="wump_txnrow"
                                                    onclick="openTransactionModal('TXN001', '1/15/2025', 'Tithe', 'John Doe', 'income', '+₵500')">
                                                    <td class="wump_txnid">TXN001</td>
                                                    <td>1/15/2025</td>
                                                    <td>Tithe</td>
                                                    <td>John Doe</td>
                                                    <td><span class="wump_catbadge income">income</span></td>
                                                    <td class="wump_amtpos">+₵500</td>
                                                </tr>
                                                <tr class="wump_txnrow"
                                                    onclick="openTransactionModal('TXN002', '1/15/2025', 'Offering', 'General', 'income', '+₵1,200')">
                                                    <td class="wump_txnid">TXN002</td>
                                                    <td>1/15/2025</td>
                                                    <td>Offering</td>
                                                    <td>General</td>
                                                    <td><span class="wump_catbadge income">income</span></td>
                                                    <td class="wump_amtpos">+₵1,200</td>
                                                </tr>
                                                <tr class="wump_txnrow"
                                                    onclick="openTransactionModal('TXN003', '1/14/2025', 'Expenses', 'Utilities', 'expense', '-₵450')">
                                                    <td class="wump_txnid">TXN003</td>
                                                    <td>1/14/2025</td>
                                                    <td>Expenses</td>
                                                    <td>Utilities</td>
                                                    <td><span class="wump_catbadge expense">expense</span></td>
                                                    <td class="wump_amtneg">-₵450</td>
                                                </tr>
                                                <tr class="wump_txnrow"
                                                    onclick="openTransactionModal('TXN004', '1/14/2025', 'Project Offering', 'General', 'income', '+₵800')">
                                                    <td class="wump_txnid">TXN004</td>
                                                    <td>1/14/2025</td>
                                                    <td>Project Offering</td>
                                                    <td>General</td>
                                                    <td><span class="wump_catbadge income">income</span></td>
                                                    <td class="wump_amtpos">+₵800</td>
                                                </tr>
                                                <tr class="wump_txnrow"
                                                    onclick="openTransactionModal('TXN005', '1/13/2025', 'Welfare', 'Jane Smith', 'income', '+₵150')">
                                                    <td class="wump_txnid">TXN005</td>
                                                    <td>1/13/2025</td>
                                                    <td>Welfare</td>
                                                    <td>Jane Smith</td>
                                                    <td><span class="wump_catbadge income">income</span></td>
                                                    <td class="wump_amtpos">+₵150</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                </div>
                <!-- End Overview Content -->
                
                <!-- Offerings Management Content -->
                <div id="offeringsContent" class="zump_contwrap">
                    <section class="yump_offarea active">
                        <div class="zorp_container">
                            <div class="yump_offhead">
                                <div>
                                    <h2>Offerings Management</h2>
                                    <p class="yump_offsub">Track general offerings from members and visitors. All offerings are
                                        recorded as totals.</p>
                                </div>
                                <div class="yump_offfilt">
                                    <label for="offeringsDateRange" class="yump_filtlab">Filter by Date:</label>
                                    <select id="offeringsDateRange" class="yump_datesel" onchange="filterOfferings(this.value)">
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                        <option value="quarter">This Quarter</option>
                                        <option value="year">This Year</option>
                                        <option value="all" selected>All Time</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>
                            </div>
                            <div class="yump_offgrid">
                                <!-- Today's Offerings -->
                                <div class="yump_offcard cardbluelight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">Today's Offerings</span>
                                        <div class="yump_officon iconbluealt">
                                            ₵
                                        </div>
                                    </div>
                                    <div class="yump_offamt" id="offeringsTodayAmount">₵0</div>
                                    <div class="yump_offmeta" id="offeringsTodayMeta">0 services recorded</div>
                                </div>

                                <!-- This Week -->
                                <div class="yump_offcard cardpurplight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">This Week</span>
                                        <div class="yump_officon iconpurplealt">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path d="M13 7L19 13M19 13L13 19M19 13H5" stroke="currentColor" stroke-width="2.5"
                                                    stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="yump_offamt" id="offeringsWeekAmount">₵0</div>
                                    <div class="yump_offmeta" id="offeringsWeekMeta">↑ 0% from last week</div>
                                </div>

                                <!-- This Month -->
                                <div class="yump_offcard cardgreenlight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">This Month</span>
                                        <div class="yump_officon icongreenalt">
                                            ₵
                                        </div>
                                    </div>
                                    <div class="yump_offamt" id="offeringsMonthAmount">₵0</div>
                                    <div class="yump_offmeta" id="offeringsMonthMeta">Average: ₵0/service</div>
                                </div>

                                <!-- Special Offerings -->
                                <div class="yump_offcard cardyellowlight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">Special Offerings</span>
                                        <div class="yump_officon iconyellowalt">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"
                                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                    stroke-linejoin="round" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="yump_offamt" id="offeringsSpecialAmount">₵0.00</div>
                                    <div class="yump_offmeta" id="offeringsSpecialMeta">Various projects</div>
                                </div>
                            </div>
                
                            <!-- Offerings Records Table -->
                            <div class="eorp_exparea" style="margin-top: 40px;">
                                <div class="eorp_exphead">
                                    <div>
                                        <h3>Offering Records</h3>
                                        <p class="eorp_expsub">Detailed breakdown of all offering collections</p>
                                    </div>
                                    <div class="eorp_expacts">
                                        <button class="borp_actbtn" onclick="addOffering()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                                <line x1="5" y1="12" x2="19" y2="12"></line>
                                            </svg>
                                            Add Record
                                        </button>
                                        <button class="borp_actbtn" onclick="exportOfferings()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                <polyline points="7 10 12 15 17 10"></polyline>
                                                <line x1="12" y1="15" x2="12" y2="3"></line>
                                            </svg>
                                            Export
                                        </button>
                                    </div>
                                </div>
                
                                <!-- Search Bar -->
                                <div class="corp_searchcont">
                                    <svg class="corp_searchic" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                    </svg>
                                    <input type="text" id="offeringsSearchInput" class="corp_searchinp"
                                        placeholder="Search by date, service type, amount..." oninput="searchOfferings(this.value)">
                                </div>
                
                                <div class="eorp_exptablewrap">
                                    <table class="eorp_exptable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Service Type</th>
                                                <th>Time</th>
                                                <th>Amount Collected</th>
                                                <th>Collection Method</th>
                                                <th>Counted By</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="offeringsList">
                                            <tr class="eorp_exprow">
                                                <td>10/22/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Sunday Worship</div>
                                                        <div class="eorp_expnote">Main sanctuary</div>
                                                    </div>
                                                </td>
                                                <td>9:00 AM</td>
                                                <td class="wump_amtpos">₵1,850</td>
                                                <td><span class="borp_paymeth">Cash & Mobile</span></td>
                                                <td>Deacon John</td>
                                                <td><span class="borp_statbadge borp_statpaid">Verified</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewOfferingDetails('OFF001')"
                                                            title="View Details">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editOffering('OFF001')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteOffering('OFF001', event)" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="eorp_exprow">
                                                <td>10/21/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Wednesday Service</div>
                                                        <div class="eorp_expnote">Midweek service</div>
                                                    </div>
                                                </td>
                                                <td>6:30 PM</td>
                                                <td class="wump_amtpos">₵950</td>
                                                <td><span class="borp_paymeth">Cash</span></td>
                                                <td>Elder Sarah</td>
                                                <td><span class="borp_statbadge borp_statpaid">Verified</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewOfferingDetails('OFF002')"
                                                            title="View Details">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editOffering('OFF002')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteOffering('OFF002', event)" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="eorp_exprow">
                                                <td>10/20/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Sunday Worship</div>
                                                        <div class="eorp_expnote">Main sanctuary</div>
                                                    </div>
                                                </td>
                                                <td>11:00 AM</td>
                                                <td class="wump_amtpos">₵2,100</td>
                                                <td><span class="borp_paymeth">Mixed</span></td>
                                                <td>Deacon Mary</td>
                                                <td><span class="borp_statbadge borp_statpaid">Verified</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewOfferingDetails('OFF003')"
                                                            title="View Details">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editOffering('OFF003')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteOffering('OFF003', event)" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="eorp_exprow">
                                                <td>10/19/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Special Offering</div>
                                                        <div class="eorp_expnote">Building project</div>
                                                    </div>
                                                </td>
                                                <td>9:00 AM</td>
                                                <td class="wump_amtpos">₵5,500</td>
                                                <td><span class="borp_paymeth">Bank Transfer</span></td>
                                                <td>Pastor Emmanuel</td>
                                                <td><span class="borp_statbadge borp_statpaid">Verified</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewOfferingDetails('OFF004')"
                                                            title="View Details">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editOffering('OFF004')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteOffering('OFF004', event)" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <!-- End Offerings Content -->
                
                <!-- Project Offering Management Content -->
                <div id="projectOfferingContent" class="zump_contwrap">
                    <section class="yump_offarea active">
                        <div class="zorp_container">
                            <div class="yump_offhead">
                                <div>
                                    <h2>Project Offering Management</h2>
                                    <p class="yump_offsub">Track project offerings from members and visitors. All project offerings are
                                        recorded as totals for specific church projects.</p>
                                </div>
                                <div class="yump_offfilt">
                                    <label for="projectOfferingDateRange" class="yump_filtlab">Filter by Date:</label>
                                    <select id="projectOfferingDateRange" class="yump_datesel" onchange="filterProjectOfferings(this.value)">
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                        <option value="quarter">This Quarter</option>
                                        <option value="year">This Year</option>
                                        <option value="all" selected>All Time</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>
                            </div>
                            <div class="yump_offgrid">
                                <!-- Today's Project Offerings -->
                                <div class="yump_offcard cardbluelight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">Today's Project Offerings</span>
                                        <div class="yump_officon iconbluealt">
                                            ₵
                                        </div>
                                    </div>
                                    <div class="yump_offamt" id="projectOfferingsTodayAmount">₵0</div>
                                    <div class="yump_offmeta" id="projectOfferingsTodayMeta">0 projects recorded</div>
                                </div>

                                <!-- This Week -->
                                <div class="yump_offcard cardpurplight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">This Week</span>
                                        <div class="yump_officon iconpurplealt">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path d="M13 7L19 13M19 13L13 19M19 13H5" stroke="currentColor" stroke-width="2.5"
                                                    stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="yump_offamt" id="projectOfferingsWeekAmount">₵0</div>
                                    <div class="yump_offmeta" id="projectOfferingsWeekMeta">↑ 0% from last week</div>
                                </div>

                                <!-- This Month -->
                                <div class="yump_offcard cardgreenlight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">This Month</span>
                                        <div class="yump_officon icongreenalt">
                                            ₵
                                        </div>
                                    </div>
                                    <div class="yump_offamt" id="projectOfferingsMonthAmount">₵0</div>
                                    <div class="yump_offmeta" id="projectOfferingsMonthMeta">Average: ₵0 /project</div>
                                </div>

                                <!-- Special Project Offerings -->
                                <div class="yump_offcard cardyellowlight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">Active Projects</span>
                                        <div class="yump_officon iconyellowalt">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"
                                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                    stroke-linejoin="round" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="yump_offamt" id="projectOfferingsActiveCount">0</div>
                                    <div class="yump_offmeta" id="projectOfferingsActiveMeta">Building fund, Mission, etc.</div>
                                </div>
                            </div>
                
                            <!-- Project Offering Records Table -->
                            <div class="eorp_exparea" style="margin-top: 40px;">
                                <div class="eorp_exphead">
                                    <div>
                                        <h3>Project Offering Records</h3>
                                        <p class="eorp_expsub">Detailed breakdown of all project offering collections</p>
                                    </div>
                                    <div class="eorp_expacts">
                                        <button class="borp_actbtn" onclick="addProjectOffering()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                                <line x1="5" y1="12" x2="19" y2="12"></line>
                                            </svg>
                                            Add Record
                                        </button>
                                        <button class="borp_actbtn" onclick="exportProjectOfferings()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                <polyline points="7 10 12 15 17 10"></polyline>
                                                <line x1="12" y1="15" x2="12" y2="3"></line>
                                            </svg>
                                            Export
                                        </button>
                                    </div>
                                </div>
                
                                <!-- Search Bar -->
                                <div class="corp_searchcont">
                                    <svg class="corp_searchic" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                    </svg>
                                    <input type="text" id="projectOfferingSearchInput" class="corp_searchinp"
                                        placeholder="Search by date, service type, amount..." oninput="searchProjectOfferings(this.value)">
                                </div>
                
                                <div class="eorp_exptablewrap">
                                    <table class="eorp_exptable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Service Type</th>
                                                <th>Time</th>
                                                <th>Amount Collected</th>
                                                <th>Collection Method</th>
                                                <th>Counted By</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="projectOfferingsList">
                                            <tr class="eorp_exprow">
                                                <td>10/22/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Sunday Worship</div>
                                                        <div class="eorp_expnote">Building project</div>
                                                    </div>
                                                </td>
                                                <td>9:00 AM</td>
                                                <td class="wump_amtpos">₵3,200</td>
                                                <td><span class="borp_paymeth">Cash & Mobile</span></td>
                                                <td>Deacon John</td>
                                                <td><span class="borp_statbadge borp_statpaid">Verified</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewProjectOfferingDetails('POFF001')"
                                                            title="View Details">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editProjectOffering('POFF001')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteProjectOffering('POFF001')" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="eorp_exprow">
                                                <td>10/21/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Wednesday Service</div>
                                                        <div class="eorp_expnote">Mission project</div>
                                                    </div>
                                                </td>
                                                <td>6:30 PM</td>
                                                <td class="wump_amtpos">₵1,450</td>
                                                <td><span class="borp_paymeth">Cash</span></td>
                                                <td>Elder Sarah</td>
                                                <td><span class="borp_statbadge borp_statpaid">Verified</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewProjectOfferingDetails('POFF002')"
                                                            title="View Details">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editProjectOffering('POFF002')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteProjectOffering('POFF002')" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="eorp_exprow">
                                                <td>10/20/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Sunday Worship</div>
                                                        <div class="eorp_expnote">Building project</div>
                                                    </div>
                                                </td>
                                                <td>11:00 AM</td>
                                                <td class="wump_amtpos">₵2,800</td>
                                                <td><span class="borp_paymeth">Mixed</span></td>
                                                <td>Deacon Mary</td>
                                                <td><span class="borp_statbadge borp_statpaid">Verified</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewProjectOfferingDetails('POFF003')"
                                                            title="View Details">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editProjectOffering('POFF003')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteProjectOffering('POFF003')" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="eorp_exprow">
                                                <td>10/19/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Special Project Offering</div>
                                                        <div class="eorp_expnote">Church expansion</div>
                                                    </div>
                                                </td>
                                                <td>9:00 AM</td>
                                                <td class="wump_amtpos">₵8,500</td>
                                                <td><span class="borp_paymeth">Bank Transfer</span></td>
                                                <td>Pastor Emmanuel</td>
                                                <td><span class="borp_statbadge borp_statpaid">Verified</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewProjectOfferingDetails('POFF004')"
                                                            title="View Details">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editProjectOffering('POFF004')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteProjectOffering('POFF004')" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <!-- End Project Offering Content -->
                
                <!-- CPS Tracking Content -->
                <div id="cpsContent" class="zump_contwrap">
                    <section class="yump_offarea active">
                        <div class="zorp_container">
                            <div class="yump_offhead">
                                <div>
                                    <h2>CPS Tracking</h2>
                                    <p class="yump_offsub">Individual tithe records for all members. Each contribution is recorded
                                        with receipt generation.</p>
                                </div>
                                <div class="yump_offfilt">
                                    <label for="cpsDateRange" class="yump_filtlab">Filter by Date:</label>
                                    <select id="cpsDateRange" class="yump_datesel" onchange="filterCPS(this.value)">
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                        <option value="quarter">This Quarter</option>
                                        <option value="year">This Year</option>
                                        <option value="all" selected>All Time</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>
                            </div>
                            <div class="yump_offgrid">
                                <!-- Members Contributing -->
                                <div class="yump_offcard cardbluelight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">Members Contributing</span>
                                        <div class="yump_officon iconbluealt">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                                <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2" />
                                                <path d="M22 21v-2a4 4 0 0 0-3-3.87" stroke="currentColor" stroke-width="2"
                                                    stroke-linecap="round" stroke-linejoin="round" />
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="2"
                                                    stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="yump_offamt cps-amount">0</div>
                                </div>
                
                                <!-- This Month -->
                                <div class="yump_offcard cardgreenlight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">This Month</span>
                                        <div class="yump_officon icongreenalt">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path d="M13 7L19 13M19 13L13 19M19 13H5" stroke="currentColor" stroke-width="2.5"
                                                    stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="yump_offamt cps-amount">₵0.00</div>
                                </div>
                
                                <!-- Average per Member -->
                                <div class="yump_offcard cardyellowlight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">Average per Member</span>
                                        <div class="yump_officon iconyellowalt">
                                            ₵
                                        </div>
                                    </div>
                                    <div class="yump_offamt cps-amount">₵0.00</div>
                                </div>
                            </div>
                
                            <!-- CPS Contributors List -->
                            <div class="borp_cpsarea">
                                <div class="borp_cpshead">
                                    <div>
                                        <h3>CPS Contributors</h3>
                                        <p class="borp_cpssub">Complete list of all members who paid CPS this month</p>
                                    </div>
                                    <div class="borp_cpsacts">
                                        <button class="borp_actbtn btn-alt" onclick="selectAllCPS()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <polyline points="9 11 12 14 22 4"></polyline>
                                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                                            </svg>
                                            Select All
                                        </button>
                                        <button class="borp_actbtn btn-alt" onclick="clearSelectionCPS()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                            </svg>
                                            Clear Selection
                                        </button>
                                    </div>
                                </div>
                
                                <!-- Search Bar -->
                                <div class="corp_searchcont">
                                    <svg class="corp_searchic" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                    </svg>
                                    <input type="text" id="cpsSearchInput" class="corp_searchinp"
                                        placeholder="Search by name, amount, payment method..."
                                        oninput="searchCPSContributors(this.value)">
                                </div>
                
                                <div class="borp_cpstablewrap">
                                    <table class="borp_cpstable">
                                        <thead>
                                            <tr>
                                                <th><input type="checkbox" class="select-all-checkbox" onchange="toggleAllCPS(this)">
                                                </th>
                                                <th>Member</th>
                                                <th>Amount Paid</th>
                                                <th>Payment Date</th>
                                                <th>Payment Method</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="cpsContributorsList">
                                            <!-- Sample CPS Contributors -->
                                            <tr class="borp_cpsrow">
                                                <td><input type="checkbox" class="member-checkbox"></td>
                                                <td>
                                                    <div class="borp_meminfo">
                                                        <div class="borp_memavatar">EE</div>
                                                        <div>
                                                            <div class="borp_memname">Emmanuel Egyin</div>
                                                            <div class="borp_mememail">admin@attendance.com</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="borp_amtcell">₵500</td>
                                                <td>10/22/2025</td>
                                                <td><span class="borp_paymeth">Bank Transfer</span></td>
                                                <td><span class="borp_statbadge borp_statpaid">Paid</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewCPSReceipt('CPS001')"
                                                            title="View">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editCPS('CPS001')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteCPS('CPS001', event)" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="borp_cpsrow">
                                                <td><input type="checkbox" class="member-checkbox"></td>
                                                <td>
                                                    <div class="borp_meminfo">
                                                        <div class="borp_memavatar">LE</div>
                                                        <div>
                                                            <div class="borp_memname">Lawrence Egyin</div>
                                                            <div class="borp_mememail">lawrenceantwi63@gmail.com</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="borp_amtcell">₵650</td>
                                                <td>10/21/2025</td>
                                                <td><span class="borp_paymeth">Cash</span></td>
                                                <td><span class="borp_statbadge borp_statpaid">Paid</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewCPSReceipt('CPS002')"
                                                            title="View">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editCPS('CPS002')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteCPS('CPS002', event)" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="borp_cpsrow">
                                                <td><input type="checkbox" class="member-checkbox"></td>
                                                <td>
                                                    <div class="borp_meminfo">
                                                        <div class="borp_memavatar">SA</div>
                                                        <div>
                                                            <div class="borp_memname">Sarah Addo</div>
                                                            <div class="borp_mememail">sarah.addo@church.com</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="borp_amtcell">₵400</td>
                                                <td>10/20/2025</td>
                                                <td><span class="borp_paymeth">Mobile Money</span></td>
                                                <td><span class="borp_statbadge borp_statpaid">Paid</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewCPSReceipt('CPS003')"
                                                            title="View">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editCPS('CPS003')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteCPS('CPS003', event)" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <!-- End CPS Content -->
                
                <!-- Welfare Tracking Content -->
                <div id="welfareContent" class="zump_contwrap">
                    <section class="yump_offarea active">
                        <div class="zorp_container">
                            <div class="yump_offhead">
                                <div>
                                    <h2>Welfare Tracking</h2>
                                    <p class="yump_offsub">Track welfare dues from all members. Each contribution supports member
                                        welfare and assistance programs.</p>
                                </div>
                                <div class="yump_offfilt">
                                    <label for="welfareDateRange" class="yump_filtlab">Filter by Date:</label>
                                    <select id="welfareDateRange" class="yump_datesel" onchange="filterWelfare(this.value)">
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                        <option value="quarter">This Quarter</option>
                                        <option value="year">This Year</option>
                                        <option value="all" selected>All Time</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>
                            </div>
                            <div class="yump_offgrid">
                                <!-- Members Contributing -->
                                <div class="yump_offcard cardbluelight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">Members Contributing</span>
                                        <div class="yump_officon iconbluealt">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                                <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2" />
                                                <path d="M22 21v-2a4 4 0 0 0-3-3.87" stroke="currentColor" stroke-width="2"
                                                    stroke-linecap="round" stroke-linejoin="round" />
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="2"
                                                    stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="yump_offamt cps-amount">0</div>
                                </div>
                
                                <!-- This Month -->
                                <div class="yump_offcard cardgreenlight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">This Month</span>
                                        <div class="yump_officon icongreenalt">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path d="M13 7L19 13M19 13L13 19M19 13H5" stroke="currentColor" stroke-width="2.5"
                                                    stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="yump_offamt cps-amount">₵0.00</div>
                                </div>
                
                                <!-- Average per Member -->
                                <div class="yump_offcard cardyellowlight">
                                    <div class="yump_offheader">
                                        <span class="yump_offtitle">Average per Member</span>
                                        <div class="yump_officon iconyellowalt">
                                            ₵
                                        </div>
                                    </div>
                                    <div class="yump_offamt cps-amount">₵0.00</div>
                                </div>
                            </div>
                
                            <!-- Welfare Contributors List -->
                            <div class="borp_cpsarea">
                                <div class="borp_cpshead">
                                    <div>
                                        <h3>Welfare Contributors</h3>
                                        <p class="borp_cpssub">Complete list of all members who paid welfare dues this month</p>
                                    </div>
                                    <div class="borp_cpsacts">
                                        <button class="borp_actbtn btn-alt" onclick="selectAllWelfare()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <polyline points="9 11 12 14 22 4"></polyline>
                                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                                            </svg>
                                            Select All
                                        </button>
                                        <button class="borp_actbtn btn-alt" onclick="clearSelectionWelfare()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                            </svg>
                                            Clear Selection
                                        </button>
                                    </div>
                                </div>
                
                                <!-- Search Bar -->
                                <div class="corp_searchcont">
                                    <svg class="corp_searchic" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                    </svg>
                                    <input type="text" id="welfareSearchInput" class="corp_searchinp"
                                        placeholder="Search by name, amount, payment method..."
                                        oninput="searchWelfareContributors(this.value)">
                                </div>
                
                                <div class="borp_cpstablewrap">
                                    <table class="borp_cpstable">
                                        <thead>
                                            <tr>
                                                <th><input type="checkbox" class="select-all-checkbox"
                                                        onchange="toggleAllWelfare(this)"></th>
                                                <th>Member</th>
                                                <th>Amount Paid</th>
                                                <th>Payment Date</th>
                                                <th>Payment Method</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="welfareContributorsList">
                                            <!-- Sample Welfare Contributors -->
                                            <tr class="borp_cpsrow">
                                                <td><input type="checkbox" class="member-checkbox"></td>
                                                <td>
                                                    <div class="borp_meminfo">
                                                        <div class="borp_memavatar">JS</div>
                                                        <div>
                                                            <div class="borp_memname">Jane Smith</div>
                                                            <div class="borp_mememail">jane.smith@church.com</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="borp_amtcell">₵150</td>
                                                <td>10/22/2025</td>
                                                <td><span class="borp_paymeth">Cash</span></td>
                                                <td><span class="borp_statbadge borp_statpaid">Paid</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewWelfareReceipt('WEL001')"
                                                            title="View">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editWelfare('WEL001')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteWelfare('WEL001', event)" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="borp_cpsrow">
                                                <td><input type="checkbox" class="member-checkbox"></td>
                                                <td>
                                                    <div class="borp_meminfo">
                                                        <div class="borp_memavatar">KO</div>
                                                        <div>
                                                            <div class="borp_memname">Kwame Osei</div>
                                                            <div class="borp_mememail">kwame.osei@church.com</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="borp_amtcell">₵150</td>
                                                <td>10/21/2025</td>
                                                <td><span class="borp_paymeth">Mobile Money</span></td>
                                                <td><span class="borp_statbadge borp_statpaid">Paid</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewWelfareReceipt('WEL002')"
                                                            title="View">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editWelfare('WEL002')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteWelfare('WEL002', event)" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="borp_cpsrow">
                                                <td><input type="checkbox" class="member-checkbox"></td>
                                                <td>
                                                    <div class="borp_meminfo">
                                                        <div class="borp_memavatar">AB</div>
                                                        <div>
                                                            <div class="borp_memname">Abena Boateng</div>
                                                            <div class="borp_mememail">abena.boateng@church.com</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="borp_amtcell">₵150</td>
                                                <td>10/20/2025</td>
                                                <td><span class="borp_paymeth">Bank Transfer</span></td>
                                                <td><span class="borp_statbadge borp_statpaid">Paid</span></td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="viewWelfareReceipt('WEL003')"
                                                            title="View">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon" onclick="editWelfare('WEL003')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteWelfare('WEL003', event)" title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <!-- End Welfare Content -->
                
                <!-- Member Payments History Content -->
                <div id="memberPaymentsContent" class="zump_contwrap">
                    <section class="yump_offarea active">
                        <div class="zorp_container">
                            <div class="yump_offhead">
                                <div>
                                    <h2>Member Payment History</h2>
                                    <p class="yump_offsub">View detailed payment records for individual members including tithes and welfare contributions</p>
                                </div>
                            </div>
                
                            <!-- Member Selection & Date Filter -->
                            <div class="member-payment-filters" style="background: #f9fafb; padding: 24px; border-radius: 12px; margin-bottom: 24px;">
                                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 16px; align-items: end;">
                                    <!-- Member Search (Autocomplete) -->
                                    <div style="position: relative;">
                                        <label for="memberSearchInput" style="display: block; font-weight: 500; color: #374151; margin-bottom: 8px; font-size: 14px;">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: text-bottom; margin-right: 4px;">
                                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="9" cy="7" r="4"></circle>
                                                <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                            </svg>
                                            Search Member by Name
                                        </label>
                                        <div style="position: relative;">
                                            <input 
                                                type="text" 
                                                id="memberSearchInput" 
                                                placeholder="Type member name to search..." 
                                                autocomplete="off"
                                                oninput="searchMembers(this.value)"
                                                onfocus="showMemberSuggestions()"
                                                style="width: 100%; padding: 10px 40px 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background: white;">
                                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); pointer-events: none;">
                                                <circle cx="11" cy="11" r="8"></circle>
                                                <path d="m21 21-4.3-4.3"></path>
                                            </svg>
                                        </div>
                                        <!-- Hidden input to store selected member ID -->
                                        <input type="hidden" id="selectedMemberId" value="">
                                        
                                        <!-- Autocomplete Suggestions Dropdown -->
                                        <div id="memberSuggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #d1d5db; border-radius: 8px; margin-top: 4px; max-height: 300px; overflow-y: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.1); z-index: 1000;">
                                            <!-- Suggestions will be populated here -->
                                        </div>
                                    </div>
                
                                    <!-- Start Date -->
                                    <div>
                                        <label for="startDate" style="display: block; font-weight: 500; color: #374151; margin-bottom: 8px; font-size: 14px;">
                                            From Date
                                        </label>
                                        <input type="date" id="startDate" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                                    </div>
                
                                    <!-- End Date -->
                                    <div>
                                        <label for="endDate" style="display: block; font-weight: 500; color: #374151; margin-bottom: 8px; font-size: 14px;">
                                            To Date
                                        </label>
                                        <input type="date" id="endDate" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                                    </div>
                
                                    <!-- Search Button -->
                                    <div>
                                        <button onclick="loadMemberPaymentHistory()" style="padding: 10px 24px; background: #2563eb; color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 6px; transition: background 0.2s;" onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='#2563eb'">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="11" cy="11" r="8"></circle>
                                                <path d="m21 21-4.3-4.3"></path>
                                            </svg>
                                            Search
                                        </button>
                                    </div>
                                </div>
                
                                <!-- Quick Filter Buttons -->
                                <div style="margin-top: 16px; display: flex; gap: 8px;">
                                    <span style="font-size: 13px; color: #6b7280; align-self: center; margin-right: 8px;">Quick Filters:</span>
                                    <button onclick="setDateRange('today')" style="padding: 6px 12px; background: white; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; cursor: pointer;">Today</button>
                                    <button onclick="setDateRange('week')" style="padding: 6px 12px; background: white; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; cursor: pointer;">This Week</button>
                                    <button onclick="setDateRange('month')" style="padding: 6px 12px; background: white; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; cursor: pointer;">This Month</button>
                                    <button onclick="setDateRange('year')" style="padding: 6px 12px; background: white; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; cursor: pointer;">This Year</button>
                                    <button onclick="setDateRange('all')" style="padding: 6px 12px; background: white; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; cursor: pointer;">All Time</button>
                                </div>
                            </div>
                
                            <!-- Member Info Display -->
                            <div id="memberInfoCard" style="display: none; background: #1e40af; color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; position: relative;">
                                <button onclick="clearMemberPaymentHistory()" style="position: absolute; top: 16px; right: 16px; background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'" title="Close">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div style="display: flex; gap: 16px; align-items: center;">
                                        <div id="memberAvatar" style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 600;">
                                        </div>
                                        <div>
                                            <h3 id="memberFullName" style="margin: 0; font-size: 20px; font-weight: 600;">--</h3>
                                            <p id="memberEmail" style="margin: 4px 0 0 0; opacity: 0.9; font-size: 14px;">--</p>
                                            <p id="memberPhone" style="margin: 4px 0 0 0; opacity: 0.9; font-size: 14px;">--</p>
                                        </div>
                                    </div>
                                    <div style="text-align: right; margin-right: 40px;">
                                        <p style="margin: 0; opacity: 0.8; font-size: 13px;">Date Range</p>
                                        <p id="dateRangeDisplay" style="margin: 4px 0 0 0; font-size: 15px; font-weight: 500;">--</p>
                                    </div>
                                </div>
                            </div>
                
                            <!-- Summary Cards -->
                            <div id="paymentSummaryCards" style="display: none; margin-bottom: 24px;">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                    <!-- Total Tithes Card -->
                                    <div style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #e5e7eb;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                            <span style="color: #6b7280; font-size: 13px; font-weight: 500;">Total Tithes</span>
                                            <div style="width: 36px; height: 36px; background: #dcfce7; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                                    <path d="M13 7L19 13M19 13L13 19M19 13H5"></path>
                                                </svg>
                                            </div>
                                        </div>
                                        <div id="totalTithes" style="font-size: 24px; font-weight: 700; color: #10b981; margin-bottom: 4px;">₵0.00</div>
                                        <div id="titheCount" style="font-size: 13px; color: #6b7280;">0 transactions</div>
                                    </div>
                
                                    <!-- Total Welfare Card -->
                                    <div style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #e5e7eb;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                            <span style="color: #6b7280; font-size: 13px; font-weight: 500;">Total Welfare</span>
                                            <div style="width: 36px; height: 36px; background: #fce7f3; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#e879f9" stroke-width="2">
                                                    <path d="M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z"></path>
                                                    <path d="M12 8V12L14.5 14.5"></path>
                                                </svg>
                                            </div>
                                        </div>
                                        <div id="totalWelfare" style="font-size: 24px; font-weight: 700; color: #e879f9; margin-bottom: 4px;">₵0.00</div>
                                        <div id="welfareCount" style="font-size: 13px; color: #6b7280;">0 transactions</div>
                                    </div>
                
                                    <!-- Grand Total Card -->
                                    <div style="background: #1e40af; padding: 20px; border-radius: 12px; color: white;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                            <span style="font-size: 13px; font-weight: 500; opacity: 0.9;">Grand Total</span>
                                            <div style="width: 36px; height: 36px; background: rgba(255,255,255,0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                                    <line x1="12" y1="1" x2="12" y2="23"></line>
                                                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                                </svg>
                                            </div>
                                        </div>
                                        <div id="grandTotal" style="font-size: 24px; font-weight: 700; margin-bottom: 4px;">₵0.00</div>
                                        <div id="totalTransactions" style="font-size: 13px; opacity: 0.9;">0 total transactions</div>
                                    </div>
                                </div>
                            </div>
                
                            <!-- Payment Records Tables -->
                            <div id="paymentRecordsTables" style="display: none;">
                                <!-- Payment Type Tabs -->
                                <div style="margin-bottom: 24px; border-bottom: 2px solid #e5e7eb;">
                                    <div style="display: flex; gap: 8px;">
                                        <button id="titheTabBtn" onclick="switchPaymentTab('tithe')" style="padding: 12px 24px; background: #2563eb; color: white; border: none; border-bottom: 3px solid #2563eb; font-weight: 600; cursor: pointer; font-size: 14px; border-radius: 8px 8px 0 0;">
                                            Tithe Payments
                                        </button>
                                        <button id="welfareTabBtn" onclick="switchPaymentTab('welfare')" style="padding: 12px 24px; background: #f3f4f6; color: #6b7280; border: none; font-weight: 500; cursor: pointer; font-size: 14px; border-radius: 8px 8px 0 0;">
                                            Welfare Contributions
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Tithe Records -->
                                <div id="titheRecordsSection" style="display: block;">
                                    <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; border: 1px solid #e5e7eb;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                            <div>
                                                <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #111827;">Tithe Payments</h3>
                                                <p style="margin: 4px 0 0 0; font-size: 14px; color: #6b7280;">Individual tithe contribution records</p>
                                            </div>
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="exportMemberPayments('tithes', 'excel')" style="padding: 8px 16px; background: #10b981; color: white; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: background 0.2s;" onmouseover="this.style.background='#059669'" onmouseout="this.style.background='#10b981'">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                    <polyline points="7,10 12,15 17,10"></polyline>
                                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                                </svg>
                                                Excel
                                            </button>
                                            <button onclick="exportMemberPayments('tithes', 'pdf')" style="padding: 8px 16px; background: #dc2626; color: white; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: background 0.2s;" onmouseover="this.style.background='#b91c1c'" onmouseout="this.style.background='#dc2626'">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                                    <polyline points="14 2 14 8 20 8"></polyline>
                                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                                    <polyline points="10 9 9 9 8 9"></polyline>
                                                </svg>
                                                PDF
                                            </button>
                                        </div>
                                    </div>
                                    <div style="overflow-x: auto;">
                                        <table id="tithesTable" style="width: 100%; border-collapse: collapse;">
                                            <thead>
                                                <tr style="background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">#</th>
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">Date</th>
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">Amount</th>
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">Payment Method</th>
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">Reference</th>
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">Notes</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tithesTableBody">
                                                <tr>
                                                    <td colspan="6" style="padding: 40px; text-align: center; color: #9ca3af;">No tithe records found</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    </div>
                                </div>
                
                                <!-- Welfare Records -->
                                <div id="welfareRecordsSection" style="display: none;">
                                    <div style="background: white; border-radius: 12px; padding: 24px; border: 1px solid #e5e7eb;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                            <div>
                                                <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #111827;">Welfare Contributions</h3>
                                                <p style="margin: 4px 0 0 0; font-size: 14px; color: #6b7280;">Individual welfare dues payment records</p>
                                            </div>
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="exportMemberPayments('welfare', 'excel')" style="padding: 8px 16px; background: #10b981; color: white; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: background 0.2s;" onmouseover="this.style.background='#059669'" onmouseout="this.style.background='#10b981'">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                    <polyline points="7,10 12,15 17,10"></polyline>
                                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                                </svg>
                                                Excel
                                            </button>
                                            <button onclick="exportMemberPayments('welfare', 'pdf')" style="padding: 8px 16px; background: #dc2626; color: white; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: background 0.2s;" onmouseover="this.style.background='#b91c1c'" onmouseout="this.style.background='#dc2626'">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                                    <polyline points="14 2 14 8 20 8"></polyline>
                                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                                    <polyline points="10 9 9 9 8 9"></polyline>
                                                </svg>
                                                PDF
                                            </button>
                                        </div>
                                    </div>
                                    <div style="overflow-x: auto;">
                                        <table id="welfareTable" style="width: 100%; border-collapse: collapse;">
                                            <thead>
                                                <tr style="background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">#</th>
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">Date</th>
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">Amount</th>
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">Payment Method</th>
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">Reference</th>
                                                    <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #374151;">Notes</th>
                                                </tr>
                                            </thead>
                                            <tbody id="welfareTableBody">
                                                <tr>
                                                    <td colspan="6" style="padding: 40px; text-align: center; color: #9ca3af;">No welfare records found</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    </div>
                                </div>
                            </div>
                
                            <!-- Empty State -->
                            <div id="emptyState" style="text-align: center; padding: 60px 20px; background: #f9fafb; border-radius: 12px;">
                                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="1.5" style="margin: 0 auto 16px;">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.3-4.3"></path>
                                </svg>
                                <h3 style="margin: 0 0 8px 0; color: #374151; font-size: 18px;">Select a Member to View History</h3>
                                <p style="margin: 0; color: #6b7280; font-size: 14px;">Choose a member from the dropdown above and click Search to view their payment records</p>
                            </div>
                        </div>
                    </section>
                </div>
                <!-- End Member Payments Content -->
                
                <!-- Expenses Tracking Content -->
                <div id="expensesContent" class="zump_contwrap">
                    <section class="yump_offarea active">
                        <div class="zorp_container">
                            <div class="yump_offhead">
                                <div>
                                    <h2>Expenses Management</h2>
                                    <p class="yump_offsub">Track and manage all church expenditures with detailed categorization and
                                        approval workflow.</p>
                                </div>
                               
                            </div>
                
                            <!-- Expense Summary Cards -->
                            <div class="dorp_expsumgrid">
                                <div class="dorp_expsumcard dorp_cardredlight">
                                    <div class="dorp_exphdr">
                                        <div>
                                            <div class="dorp_exptit">Total Expenses</div>
                                            <div class="dorp_expsub">This Month</div>
                                        </div>
                                        <div class="dorp_expicon dorp_iconred">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="dorp_expamt" id="totalExpensesAmount">₵0.00</div>
                                    <div class="dorp_expchg neutral" id="totalExpensesChange">0% from last month</div>
                                </div>
                
                                <div class="dorp_expsumcard dorp_cardorangelight">
                                    <div class="dorp_exphdr">
                                        <div>
                                            <div class="dorp_exptit">Pending Approval</div>
                                            <div class="dorp_expsub">Awaiting Review</div>
                                        </div>
                                        <div class="dorp_expicon dorp_iconorange">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <polyline points="12 6 12 12 16 14"></polyline>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="dorp_expamt expct" id="pendingCount">0</div>
                                    <div class="dorp_expchg neutral" id="pendingValue">₵0.00 total value</div>
                                </div>
                
                                <div class="dorp_expsumcard cardbluelight" style="position: relative;">
                                    <div class="dorp_exphdr">
                                        <div>
                                            <div class="dorp_exptit">Budget Remaining</div>
                                            <div class="dorp_expsub" id="budgetTotal">Out of ₵0.00</div>
                                        </div>
                                        <div class="dorp_expicon iconbluealt">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 6v6l4 2"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="dorp_expamt" id="budgetRemaining">₵0.00</div>
                                    <div class="dorp_expprog">
                                        <div class="dorp_expfill" id="budgetProgress" style="width: 0%;"></div>
                                    </div>
                                    <button onclick="openBudgetSettingsModal()" style="position: absolute; top: 12px; right: 12px; background: rgba(91, 79, 222, 0.1); border: none; border-radius: 6px; padding: 6px 12px; cursor: pointer; font-size: 12px; color: #5B4FDE; font-weight: 500; transition: all 0.2s;" onmouseover="this.style.background='rgba(91, 79, 222, 0.2)'" onmouseout="this.style.background='rgba(91, 79, 222, 0.1)'" title="Set Monthly Budget">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
                                            <circle cx="12" cy="12" r="3"></circle>
                                            <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"></path>
                                        </svg>
                                        Set Budget
                                    </button>
                                </div>
                
                                <div class="dorp_expsumcard cardpurplight">
                                    <div class="dorp_exphdr">
                                        <div>
                                            <div class="dorp_exptit">Largest Category</div>
                                            <div class="dorp_expsub">This Month</div>
                                        </div>
                                        <div class="dorp_expicon iconpurplealt">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <rect x="3" y="3" width="7" height="7"></rect>
                                                <rect x="14" y="3" width="7" height="7"></rect>
                                                <rect x="14" y="14" width="7" height="7"></rect>
                                                <rect x="3" y="14" width="7" height="7"></rect>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="dorp_expamt expcat" id="largestCategory">None</div>
                                    <div class="dorp_expchg neutral" id="largestCategoryValue">₵0.00 (0%)</div>
                                </div>
                            </div>
                
                            <!-- Category Filters -->
                            <div class="dorp_expfilt">
                                <div class="dorp_filtgrp">
                                    <label class="yump_filtlab">Category:</label>
                                    <select class="dorp_filtinp" id="expenseCategoryFilter" onchange="filterExpensesByCategory()">
                                        <option value="all">All Categories</option>
                                        <option value="utilities">Utilities</option>
                                        <option value="maintenance">Maintenance</option>
                                        <option value="salaries">Salaries</option>
                                        <option value="supplies">Supplies</option>
                                        <option value="events">Events</option>
                                        <option value="transportation">Transportation</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="dorp_filtgrp">
                                    <label class="yump_filtlab">Status:</label>
                                    <select class="dorp_filtinp" id="expenseStatusFilter" onchange="filterExpensesByStatus()">
                                        <option value="all">All Statuses</option>
                                        <option value="approved">Approved</option>
                                        <option value="pending">Pending</option>
                                        <option value="rejected">Rejected</option>
                                    </select>
                                </div>
                                <div class="dorp_filtgrp">
                                    <label class="yump_filtlab">Date Range:</label>
                                    <select class="dorp_filtinp" id="expenseDateFilter" onchange="filterExpensesByDate()">
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                        <option value="quarter">This Quarter</option>
                                        <option value="year">This Year</option>
                                        <option value="all" selected>All Time</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>
                            </div>
                
                            <!-- Expenses Table -->
                            <div class="eorp_exparea">
                                <div class="eorp_exphead">
                                    <div>
                                        <h3>Expense Transactions</h3>
                                        <p class="eorp_expsub">View and manage all expense records</p>
                                    </div>
                                    <div class="eorp_expacts">
                                        <button class="borp_actbtn" onclick="exportExpenses()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                <polyline points="7 10 12 15 17 10"></polyline>
                                                <line x1="12" y1="15" x2="12" y2="3"></line>
                                            </svg>
                                            Export
                                        </button>
                                        <button class="borp_actbtn" onclick="printExpenses()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                stroke-width="2">
                                                <polyline points="6 9 6 2 18 2 18 9"></polyline>
                                                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2">
                                                </path>
                                                <rect x="6" y="14" width="12" height="8"></rect>
                                            </svg>
                                            Print
                                        </button>
                                    </div>
                                </div>
                
                                <!-- Search Bar -->
                                <div class="corp_searchcont">
                                    <svg class="corp_searchic" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                    </svg>
                                    <input type="text" id="expenseSearchInput" class="corp_searchinp"
                                        placeholder="Search by description, vendor, amount, category..."
                                        oninput="searchExpenses(this.value)">
                                </div>
                
                                <div class="eorp_exptablewrap">
                                    <table class="eorp_exptable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Description</th>
                                                <th>Category</th>
                                                <th>Vendor/Payee</th>
                                                <th>Amount</th>
                                                <th>Payment Method</th>
                                                <th>Status</th>
                                                <th>Receipt</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="expensesList">
                                            <!-- Sample Expenses -->
                                            <tr class="eorp_exprow" data-category="utilities" data-status="approved">
                                                <td>10/22/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Electricity Bill - October</div>
                                                        <div class="eorp_expnote">Main church building</div>
                                                    </div>
                                                </td>
                                                <td><span class="forp_cattag forp_catutil">Utilities</span></td>
                                                <td>ECG</td>
                                                <td class="wump_amtneg">₵2,450</td>
                                                <td><span class="borp_paymeth">Bank Transfer</span></td>
                                                <td><span class="borp_statbadge forp_statapp">Approved</span></td>
                                                <td>
                                                    <button class="gorp_receiptbtn" onclick="viewReceipt('EXP001')"
                                                        title="View Receipt">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                            stroke="currentColor" stroke-width="2">
                                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z">
                                                            </path>
                                                            <polyline points="14 2 14 8 20 8"></polyline>
                                                        </svg>
                                                    </button>
                                                </td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="editExpense('EXP001')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteExpense('EXP001', event)"
                                                            title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path
                                                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="eorp_exprow" data-category="maintenance" data-status="approved">
                                                <td>10/20/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">AC Maintenance & Repair</div>
                                                        <div class="eorp_expnote">Sanctuary AC units servicing</div>
                                                    </div>
                                                </td>
                                                <td><span class="forp_cattag forp_catmaint">Maintenance</span></td>
                                                <td>Cool Tech Services</td>
                                                <td class="wump_amtneg">₵1,800</td>
                                                <td><span class="borp_paymeth">Cash</span></td>
                                                <td><span class="borp_statbadge forp_statapp">Approved</span></td>
                                                <td>
                                                    <button class="gorp_receiptbtn" onclick="viewReceipt('EXP002')"
                                                        title="View Receipt">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                            stroke="currentColor" stroke-width="2">
                                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z">
                                                            </path>
                                                            <polyline points="14 2 14 8 20 8"></polyline>
                                                        </svg>
                                                    </button>
                                                </td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="editExpense('EXP002')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteExpense('EXP002', event)"
                                                            title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path
                                                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="eorp_exprow" data-category="supplies" data-status="pending">
                                                <td>10/19/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Office Supplies</div>
                                                        <div class="eorp_expnote">Printer paper, pens, folders</div>
                                                    </div>
                                                </td>
                                                <td><span class="forp_cattag forp_catsupp">Supplies</span></td>
                                                <td>Stationery Hub</td>
                                                <td class="wump_amtneg">₵450</td>
                                                <td><span class="borp_paymeth">Mobile Money</span></td>
                                                <td><span class="borp_statbadge forp_statpend">Pending</span></td>
                                                <td>
                                                    <button class="gorp_receiptbtn" onclick="viewReceipt('EXP003')"
                                                        title="View Receipt">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                            stroke="currentColor" stroke-width="2">
                                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z">
                                                            </path>
                                                            <polyline points="14 2 14 8 20 8"></polyline>
                                                        </svg>
                                                    </button>
                                                </td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon gorp_appbtn" onclick="approveExpense('EXP003')"
                                                            title="Approve">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="20 6 9 17 4 12"></polyline>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_rejbtn" onclick="rejectExpense('EXP003')"
                                                            title="Reject">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="eorp_exprow" data-category="transportation" data-status="approved">
                                                <td>10/18/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Fuel for Church Van</div>
                                                        <div class="eorp_expnote">Weekly outreach program</div>
                                                    </div>
                                                </td>
                                                <td><span class="forp_cattag forp_cattrans">Transportation</span></td>
                                                <td>Total Fuel Station</td>
                                                <td class="wump_amtneg">₵650</td>
                                                <td><span class="borp_paymeth">Cash</span></td>
                                                <td><span class="borp_statbadge forp_statapp">Approved</span></td>
                                                <td>
                                                    <button class="gorp_receiptbtn" onclick="viewReceipt('EXP004')"
                                                        title="View Receipt">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                            stroke="currentColor" stroke-width="2">
                                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z">
                                                            </path>
                                                            <polyline points="14 2 14 8 20 8"></polyline>
                                                        </svg>
                                                    </button>
                                                </td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon" onclick="editExpense('EXP004')" title="Edit">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                </path>
                                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_delbtn" onclick="deleteExpense('EXP004', event)"
                                                            title="Delete">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path
                                                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                                                </path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="eorp_exprow" data-category="utilities" data-status="pending">
                                                <td>10/17/2025</td>
                                                <td>
                                                    <div class="eorp_expdesc">
                                                        <div class="eorp_exptit">Water Bill - October</div>
                                                        <div class="eorp_expnote">Main building and grounds</div>
                                                    </div>
                                                </td>
                                                <td><span class="forp_cattag forp_catutil">Utilities</span></td>
                                                <td>Ghana Water Company</td>
                                                <td class="wump_amtneg">₵850</td>
                                                <td><span class="borp_paymeth">Bank Transfer</span></td>
                                                <td><span class="borp_statbadge forp_statpend">Pending</span></td>
                                                <td>
                                                    <button class="gorp_receiptbtn" onclick="viewReceipt('EXP005')"
                                                        title="View Receipt">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                            stroke="currentColor" stroke-width="2">
                                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z">
                                                            </path>
                                                            <polyline points="14 2 14 8 20 8"></polyline>
                                                        </svg>
                                                    </button>
                                                </td>
                                                <td>
                                                    <div class="gorp_actbtns">
                                                        <button class="borp_acticon gorp_appbtn" onclick="approveExpense('EXP005')"
                                                            title="Approve">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <polyline points="20 6 9 17 4 12"></polyline>
                                                            </svg>
                                                        </button>
                                                        <button class="borp_acticon gorp_rejbtn" onclick="rejectExpense('EXP005')"
                                                            title="Reject">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2">
                                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <!-- End Expenses Content -->
                
                <!-- Transaction Detail Modal -->
                <div class="xorp_modalbg" id="transactionModal">
                    <div class="xorp_modalcont">
                        <div class="xorp_modalhead">
                            <h3>Transaction Details</h3>
                            <button class="xorp_modalclose" onclick="closeTransactionModal()">×</button>
                        </div>
                        <div class="xorp_modalbody" id="transactionDetails">
                            <!-- Transaction details will be inserted here -->
                        </div>
                    </div>
                </div>
                
                
                
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                <script>
                    // Line Chart Interactivity
                    const chartContainer = document.getElementById('lineChartContainer');
                    const tooltip = document.getElementById('chartTooltip');
                    const chartDots = document.querySelectorAll('.vorp_dot');
                    const hoverLine = document.getElementById('hoverLine');

                    // Data for tooltips
                    window.chartData = {
                        'Jan': { income: '₵135,000', expenses: '₵45,000' },
                        'Feb': { income: '₵145,000', expenses: '₵48,000' },
                        'Mar': { income: '₵125,000', expenses: '₵42,000' },
                        'Apr': { income: '₵175,000', expenses: '₵50,000' },
                        'May': { income: '₵170,000', expenses: '₵48,000' },
                        'Jun': { income: '₵170,000', expenses: '₵49,000' }
                    };

                    chartDots.forEach(dot => {
                        dot.addEventListener('mouseenter', function (e) {
                            const month = this.getAttribute('data-month');
                            const data = chartData[month];
                            const strokeColor = this.getAttribute('stroke');
                            const cx = this.getAttribute('cx');

                            // Fill the dot with its stroke color on hover
                            this.setAttribute('fill', strokeColor);

                            // Show vertical hover line at dot position
                            hoverLine.setAttribute('x1', cx);
                            hoverLine.setAttribute('x2', cx);
                            hoverLine.setAttribute('opacity', '1');

                            tooltip.innerHTML = `
                                    <div class="vorp_tipmonth">${month}</div>
                                    <div class="vorp_tipinc">Total Income : ${data.income}</div>
                                    <div class="vorp_tipexp">Total Expenses : ${data.expenses}</div>
                                `;
                            tooltip.classList.add('show');
                        });

                        dot.addEventListener('mousemove', function (e) {
                            const rect = chartContainer.getBoundingClientRect();
                            const x = e.clientX - rect.left;
                            const y = e.clientY - rect.top;

                            tooltip.style.left = (x + 15) + 'px';
                            tooltip.style.top = (y - 60) + 'px';
                        });

                        dot.addEventListener('mouseleave', function () {
                            // Reset fill to white when mouse leaves
                            this.setAttribute('fill', 'white');

                            // Hide hover line
                            hoverLine.setAttribute('opacity', '0');

                            tooltip.classList.remove('show');
                        });
                    });

                    // Donation Categories Pie Chart
                    const categoriesCtx = document.getElementById('categoriesChart').getContext('2d');
                    window.categoriesChart = new Chart(categoriesCtx, {
                        type: 'pie',
                        data: {
                            labels: ['Tithe', 'Welfare', 'Project Offering', 'Offering', 'Other'],
                            datasets: [{
                                data: [65, 20, 8, 3, 4],
                                backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EC4899', '#8B5CF6'],
                                borderWidth: 2,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'right',
                                    labels: {
                                        padding: 15,
                                        font: {
                                            size: 13
                                        }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function (context) {
                                            const label = context.label || '';
                                            const value = context.parsed;
                                            return label + ': ' + value + '%';
                                        }
                                    }
                                }
                            }
                        }
                    });

                    // Transaction Modal Functions
                    function openTransactionModal(txnId, date, type, member, category, amount) {
                        const modal = document.getElementById('transactionModal');
                        const details = document.getElementById('transactionDetails');

                        const isIncome = category === 'income';
                        const statusBadge = isIncome ?
                            '<span class="xorp_modalstat">Completed</span>' :
                            '<span class="xorp_modalstat expense-status">Paid</span>';

                        details.innerHTML = `
                                <div class="xorp_modaldetgrid">
                                    <div class="xorp_modaldetitem">
                                        <span class="xorp_modaldetlab">Transaction ID</span>
                                        <span class="xorp_modaldetval">${txnId}</span>
                                    </div>
                                    <div class="xorp_modaldetitem">
                                        <span class="xorp_modaldetlab">Date</span>
                                        <span class="xorp_modaldetval">${date}</span>
                                    </div>
                                    <div class="xorp_modaldetitem">
                                        <span class="xorp_modaldetlab">Type</span>
                                        <span class="xorp_modaldetval">${type}</span>
                                    </div>
                                    <div class="xorp_modaldetitem">
                                        <span class="xorp_modaldetlab">Member/Description</span>
                                        <span class="xorp_modaldetval">${member}</span>
                                    </div>
                                    <div class="xorp_modaldetitem">
                                        <span class="xorp_modaldetlab">Category</span>
                                        <span class="wump_catbadge ${category}">${category}</span>
                                    </div>
                                    <div class="xorp_modaldetitem">
                                        <span class="xorp_modaldetlab">Amount</span>
                                        <span class="xorp_modaldetval" style="color: ${isIncome ? '#10B981' : '#EF4444'}; font-weight: 700;">${amount}</span>
                                    </div>
                                </div>
                                <div class="xorp_modalacts">
                                    <button class="xorp_modalbtn" onclick="alert('Printing receipt for ${txnId}...')">Print Receipt</button>
                                    ${isIncome ? '<button class="xorp_modalbtn" onclick="alert(\'Sending thank you message...\')">Send Thank You</button>' : ''}
                                </div>
                            `;

                        modal.classList.add('show');
                    }

                    function closeTransactionModal() {
                        const modal = document.getElementById('transactionModal');
                        modal.classList.remove('show');
                    }

                    // Close modal when clicking outside
                    document.getElementById('transactionModal').addEventListener('click', function (e) {
                        if (e.target === this) {
                            closeTransactionModal();
                        }
                    });

                    // Tab Switching Functionality
                    const tabs = document.querySelectorAll('.qery_tab');
                    const contentWrappers = document.querySelectorAll('.zump_contwrap');

                    tabs.forEach((tab, index) => {
                        tab.addEventListener('click', function () {
                            // Remove active class from all tabs
                            tabs.forEach(t => t.classList.remove('active'));

                            // Add active class to clicked tab
                            this.classList.add('active');

                            // Hide all content wrappers
                            contentWrappers.forEach(wrapper => wrapper.classList.remove('active'));

                            // Show corresponding content
                            const tabText = this.textContent.trim();
                            console.log('Tab clicked:', tabText); // Debug log
                            
                            if (tabText === 'Overview') {
                                document.getElementById('overviewContent').classList.add('active');
                            } else if (tabText === 'Offerings') {
                                const offeringsContent = document.getElementById('offeringsContent');
                                if (offeringsContent) {
                                    offeringsContent.classList.add('active');
                                    console.log('Offerings content activated');
                                } else {
                                    console.error('offeringsContent not found!');
                                }
                            } else if (tabText === 'Project Offering') {
                                document.getElementById('projectOfferingContent').classList.add('active');
                            } else if (tabText === 'Tithes (CPS)') {
                                document.getElementById('cpsContent').classList.add('active');
                            } else if (tabText === 'Welfare') {
                                document.getElementById('welfareContent').classList.add('active');
                            } else if (tabText === 'Member Payments') {
                                document.getElementById('memberPaymentsContent').classList.add('active');
                                loadMembersForDropdown(); // Load members when tab opens
                            } else if (tabText === 'Expenses') {
                                document.getElementById('expensesContent').classList.add('active');
                            }
                        });
                    });

                    // CPS Search Functionality
                    function searchCPSContributors(query) {
                        const table = document.getElementById('cpsContributorsList');
                        const rows = table.getElementsByClassName('borp_cpsrow');
                        const searchTerm = query.toLowerCase();

                        Array.from(rows).forEach(row => {
                            const name = row.querySelector('.borp_memname').textContent.toLowerCase();
                            const email = row.querySelector('.borp_mememail').textContent.toLowerCase();
                            const amount = row.querySelector('.borp_amtcell').textContent.toLowerCase();
                            const paymentMethod = row.querySelector('.borp_paymeth').textContent.toLowerCase();

                            if (name.includes(searchTerm) || email.includes(searchTerm) ||
                                amount.includes(searchTerm) || paymentMethod.includes(searchTerm)) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        });
                    }

                    // Welfare Search Functionality
                    function searchWelfareContributors(query) {
                        const table = document.getElementById('welfareContributorsList');
                        const rows = table.getElementsByClassName('borp_cpsrow');
                        const searchTerm = query.toLowerCase();

                        Array.from(rows).forEach(row => {
                            const name = row.querySelector('.borp_memname').textContent.toLowerCase();
                            const email = row.querySelector('.borp_mememail').textContent.toLowerCase();
                            const amount = row.querySelector('.borp_amtcell').textContent.toLowerCase();
                            const paymentMethod = row.querySelector('.borp_paymeth').textContent.toLowerCase();

                            if (name.includes(searchTerm) || email.includes(searchTerm) ||
                                amount.includes(searchTerm) || paymentMethod.includes(searchTerm)) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        });
                    }

                    // CPS Selection Functions
                    function toggleAllCPS(checkbox) {
                        const checkboxes = document.querySelectorAll('#cpsContributorsList .member-checkbox');
                        checkboxes.forEach(cb => cb.checked = checkbox.checked);
                    }

                    function selectAllCPS() {
                        const checkboxes = document.querySelectorAll('#cpsContributorsList .member-checkbox');
                        const selectAllCheckbox = document.querySelector('#cpsContributorsList').closest('.borp_cpsarea').querySelector('.select-all-checkbox');
                        checkboxes.forEach(cb => cb.checked = true);
                        if (selectAllCheckbox) selectAllCheckbox.checked = true;
                    }

                    function clearSelectionCPS() {
                        const checkboxes = document.querySelectorAll('#cpsContributorsList .member-checkbox');
                        const selectAllCheckbox = document.querySelector('#cpsContributorsList').closest('.borp_cpsarea').querySelector('.select-all-checkbox');
                        checkboxes.forEach(cb => cb.checked = false);
                        if (selectAllCheckbox) selectAllCheckbox.checked = false;
                    }

                    function viewCPSReceipt(cpsId) {
                        // Fetch the tithe details
                        fetch(`get_finance_data.php?type=tithe_details&id=${cpsId}`)
                            .then(response => response.json())
                            .then(result => {
                                if (result.success && result.data) {
                                    const tithe = result.data;

                                    // Generate profile picture HTML
                                    let profilePicHTML;
                                    if (tithe.member_photo && tithe.member_photo.trim() !== '') {
                                        profilePicHTML = `<img src="../Add_Members/${tithe.member_photo}" alt="${tithe.member_name}" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #5B4FDE;">`;
                                    } else {
                                        const initials = tithe.member_name ? tithe.member_name.split(' ').map(n => n[0]).join('').toUpperCase() : 'NA';
                                        profilePicHTML = `<div style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: bold; color: white; border: 4px solid #5B4FDE;">${initials}</div>`;
                                    }

                                    // Create professional receipt
                                    const modalContent = `
                                        <div style="padding: 40px; background: white; max-width: 800px; margin: 0 auto;">
                                            <!-- Header -->
                                            <div style="text-align: center; border-bottom: 3px solid #5B4FDE; padding-bottom: 20px; margin-bottom: 30px;">
                                                <h1 style="margin: 0; color: #1e293b; font-size: 32px; font-weight: 700;">CPS / TITHE RECEIPT</h1>
                                                <p style="margin: 10px 0 0 0; color: #64748b; font-size: 16px;">Church Payment System Contribution</p>
                                            </div>

                                            <!-- Member Info with Photo -->
                                            <div style="display: flex; align-items: center; gap: 30px; margin-bottom: 30px; padding: 25px; background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%); border-radius: 12px; border-left: 5px solid #5B4FDE;">
                                                <div>${profilePicHTML}</div>
                                                <div style="flex: 1;">
                                                    <h2 style="margin: 0 0 10px 0; color: #1e293b; font-size: 24px;">${tithe.member_name || 'Unknown Member'}</h2>
                                                    <p style="margin: 5px 0; color: #64748b;"><strong>Email:</strong> ${tithe.member_email || 'N/A'}</p>
                                                    <p style="margin: 5px 0; color: #64748b;"><strong>Phone:</strong> ${tithe.member_phone || 'N/A'}</p>
                                                    <p style="margin: 5px 0; color: #64748b;"><strong>Address:</strong> ${tithe.member_address || 'N/A'}</p>
                                                </div>
                                            </div>

                                            <!-- Transaction Details -->
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                                                <div style="padding: 20px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                                    <p style="margin: 0 0 5px 0; color: #64748b; font-size: 14px;">Transaction ID</p>
                                                    <p style="margin: 0; color: #1e293b; font-size: 18px; font-weight: 600;">${tithe.transaction_id}</p>
                                                </div>
                                                <div style="padding: 20px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                                    <p style="margin: 0 0 5px 0; color: #64748b; font-size: 14px;">Date</p>
                                                    <p style="margin: 0; color: #1e293b; font-size: 18px; font-weight: 600;">${new Date(tithe.date).toLocaleDateString()}</p>
                                                </div>
                                                <div style="padding: 20px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                                    <p style="margin: 0 0 5px 0; color: #64748b; font-size: 14px;">Payment Method</p>
                                                    <p style="margin: 0; color: #1e293b; font-size: 18px; font-weight: 600;">${tithe.payment_method || 'Cash'}</p>
                                                </div>
                                                <div style="padding: 20px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                                    <p style="margin: 0 0 5px 0; color: #64748b; font-size: 14px;">Status</p>
                                                    <p style="margin: 0; color: #10b981; font-size: 18px; font-weight: 600;">Paid</p>
                                                </div>
                                            </div>

                                            <!-- Amount Section -->
                                            <div style="padding: 30px; background: linear-gradient(135deg, #5B4FDE 0%, #764ba2 100%); border-radius: 12px; text-align: center; margin-bottom: 30px;">
                                                <p style="margin: 0 0 10px 0; color: rgba(255,255,255,0.9); font-size: 16px; text-transform: uppercase; letter-spacing: 1px;">Total Amount Paid</p>
                                                <p style="margin: 0; color: white; font-size: 48px; font-weight: 700;">₵${parseFloat(tithe.amount).toFixed(2)}</p>
                                            </div>

                                            <!-- Notes -->
                                            ${tithe.notes ? `
                                                <div style="padding: 20px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b; margin-bottom: 30px;">
                                                    <p style="margin: 0 0 10px 0; color: #92400e; font-weight: 600;">Notes:</p>
                                                    <p style="margin: 0; color: #78350f;">${tithe.notes}</p>
                                                </div>
                                            ` : ''}

                                            <!-- Footer -->
                                            <div style="text-align: center; padding-top: 20px; border-top: 2px solid #e2e8f0;">
                                                <p style="margin: 5px 0; color: #64748b; font-size: 14px;">Thank you for your faithful giving!</p>
                                                <p style="margin: 5px 0; color: #94a3b8; font-size: 12px;">Generated on ${new Date().toLocaleString()}</p>
                                            </div>

                                            <!-- Action Buttons -->
                                            <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center;">
                                                <button onclick="printCPSReceipt()" style="padding: 12px 30px; background: #5B4FDE; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">Print Receipt</button>
                                                <button onclick="closeCPSReceiptModal()" style="padding: 12px 30px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">Close</button>
                                            </div>
                                        </div>
                                    `;

                                    // Create or update modal
                                    let modal = document.getElementById('cpsReceiptModal');
                                    if (!modal) {
                                        modal = document.createElement('div');
                                        modal.id = 'cpsReceiptModal';
                                        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 10000; overflow-y: auto; padding: 20px;';
                                        document.body.appendChild(modal);
                                    }

                                    modal.innerHTML = `<div style="background: white; border-radius: 16px; max-width: 900px; width: 100%; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);" id="cpsReceiptContent">${modalContent}</div>`;
                                    modal.style.display = 'flex';

                                    // Close on background click
                                    modal.onclick = function(e) {
                                        if (e.target === modal) {
                                            closeCPSReceiptModal();
                                        }
                                    };
                                } else {
                                    alert('Error loading tithe details: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to load tithe details. Please try again.');
                            });
                    }

                    function closeCPSReceiptModal() {
                        const modal = document.getElementById('cpsReceiptModal');
                        if (modal) {
                            modal.style.display = 'none';
                        }
                    }

                    function printCPSReceipt() {
                        const content = document.getElementById('cpsReceiptContent').innerHTML;
                        const printWindow = window.open('', '', 'height=800,width=800');
                        printWindow.document.write('<html><head><title>CPS Receipt</title>');
                        printWindow.document.write('</head><body>');
                        printWindow.document.write(content);
                        printWindow.document.write('</body></html>');
                        printWindow.document.close();
                        printWindow.print();
                    }

                    function editCPS(cpsId) {
                        // Fetch the tithe details first
                        fetch(`get_finance_data.php?type=tithe_details&id=${cpsId}`)
                            .then(response => response.json())
                            .then(result => {
                                if (result.success && result.data) {
                                    const tithe = result.data;

                                    // Create edit modal with form
                                    const modalContent = `
                                        <div style="padding: 30px;">
                                            <h2 style="margin-top: 0; color: #1e293b; border-bottom: 2px solid #5B4FDE; padding-bottom: 10px;">Edit CPS / Tithe Record</h2>

                                            <form id="editCPSForm" style="margin-top: 20px;">
                                                <input type="hidden" id="edit_cps_transaction_id" value="${tithe.transaction_id}">

                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Date <span style="color: red;">*</span></label>
                                                        <input type="date" id="edit_cps_date" value="${tithe.date}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>

                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Amount (₵) <span style="color: red;">*</span></label>
                                                        <input type="number" step="0.01" id="edit_cps_amount" value="${tithe.amount}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                </div>

                                                <div style="margin-top: 15px;">
                                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Payment Method <span style="color: red;">*</span></label>
                                                    <select id="edit_cps_payment_method" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                        <option value="Cash" ${tithe.payment_method === 'Cash' ? 'selected' : ''}>Cash</option>
                                                        <option value="Mobile Money" ${tithe.payment_method === 'Mobile Money' ? 'selected' : ''}>Mobile Money</option>
                                                        <option value="Bank Transfer" ${tithe.payment_method === 'Bank Transfer' ? 'selected' : ''}>Bank Transfer</option>
                                                        <option value="Cheque" ${tithe.payment_method === 'Cheque' ? 'selected' : ''}>Cheque</option>
                                                    </select>
                                                </div>

                                                <div style="margin-top: 15px;">
                                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Notes</label>
                                                    <textarea id="edit_cps_notes" rows="3" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; resize: vertical;">${tithe.notes || ''}</textarea>
                                                </div>

                                                <div style="margin-top: 25px; display: flex; gap: 10px; justify-content: flex-end;">
                                                    <button type="button" onclick="closeEditCPSModal()" style="padding: 10px 24px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">Cancel</button>
                                                    <button type="submit" style="padding: 10px 24px; background: #5B4FDE; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">Save Changes</button>
                                                </div>
                                            </form>
                                        </div>
                                    `;

                                    // Create or update modal
                                    let modal = document.getElementById('editCPSModal');
                                    if (!modal) {
                                        modal = document.createElement('div');
                                        modal.id = 'editCPSModal';
                                        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000; overflow-y: auto;';
                                        document.body.appendChild(modal);
                                    }

                                    modal.innerHTML = `<div style="background: white; border-radius: 12px; max-width: 600px; width: 90%; margin: 20px auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">${modalContent}</div>`;
                                    modal.style.display = 'flex';

                                    // Handle form submission
                                    document.getElementById('editCPSForm').onsubmit = function(e) {
                                        e.preventDefault();
                                        saveCPSChanges();
                                    };

                                    // Close on background click
                                    modal.onclick = function(e) {
                                        if (e.target === modal) {
                                            closeEditCPSModal();
                                        }
                                    };
                                } else {
                                    alert('Error loading tithe details: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to load tithe details. Please try again.');
                            });
                    }

                    function closeEditCPSModal() {
                        const modal = document.getElementById('editCPSModal');
                        if (modal) {
                            modal.style.display = 'none';
                        }
                    }

                    function saveCPSChanges() {
                        const data = {
                            transaction_id: document.getElementById('edit_cps_transaction_id').value,
                            date: document.getElementById('edit_cps_date').value,
                            amount: document.getElementById('edit_cps_amount').value,
                            payment_method: document.getElementById('edit_cps_payment_method').value,
                            notes: document.getElementById('edit_cps_notes').value
                        };

                        fetch('update_tithe.php', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        })
                        .then(response => response.json())
                        .then(result => {
                            if (result.success) {
                                alert('Tithe updated successfully!');
                                closeEditCPSModal();
                                updateTopTithesStat(); // Update top overview metric
                                updateFinanceCategoriesChart(); // Update pie chart
                                updateFinancialTrendsChart(); // Update line chart
                                loadCPSContributors();
                                loadFinancialStats();
                                loadRecentTransactions();
                            } else {
                                alert('Error updating tithe: ' + (result.message || 'Unknown error'));
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('Failed to update tithe. Please try again.');
                        });
                    }

                    function deleteCPS(cpsId, event) {
                        if (confirm(`Are you sure you want to delete CPS contribution ${cpsId}?\n\nThis action cannot be undone.`)) {
                            // Make API call to delete from database
                            fetch(`delete_cps.php?id=${cpsId}`, {
                                method: 'DELETE'
                            })
                            .then(response => response.json())
                            .then(result => {
                                if (result.success) {
                                    alert(`CPS contribution ${cpsId} deleted successfully!`);

                                    // Remove the row from the table immediately
                                    if (event) {
                                        const row = event.target.closest('tr');
                                        if (row) {
                                            row.remove();
                                        }
                                    }

                                    // Refresh all financial data
                                    updateTopTithesStat(); // Update top overview metric
                                    updateFinanceCategoriesChart(); // Update pie chart
                                    updateFinancialTrendsChart(); // Update line chart
                                    loadFinancialStats();
                                    loadRecentTransactions();
                                    loadCPSContributors();
                                } else {
                                    alert('Error deleting CPS contribution: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to delete CPS contribution. Please try again.');
                            });
                        }
                    }

                    // Welfare Selection Functions
                    function toggleAllWelfare(checkbox) {
                        const checkboxes = document.querySelectorAll('#welfareContributorsList .member-checkbox');
                        checkboxes.forEach(cb => cb.checked = checkbox.checked);
                    }

                    function selectAllWelfare() {
                        const checkboxes = document.querySelectorAll('#welfareContributorsList .member-checkbox');
                        const selectAllCheckbox = document.querySelector('#welfareContributorsList').closest('.borp_cpsarea').querySelector('.select-all-checkbox');
                        checkboxes.forEach(cb => cb.checked = true);
                        if (selectAllCheckbox) selectAllCheckbox.checked = true;
                    }

                    function clearSelectionWelfare() {
                        const checkboxes = document.querySelectorAll('#welfareContributorsList .member-checkbox');
                        const selectAllCheckbox = document.querySelector('#welfareContributorsList').closest('.borp_cpsarea').querySelector('.select-all-checkbox');
                        checkboxes.forEach(cb => cb.checked = false);
                        if (selectAllCheckbox) selectAllCheckbox.checked = false;
                    }

                    function viewWelfareReceipt(welfareId) {
                        // Fetch the welfare details
                        fetch(`get_finance_data.php?type=welfare_details&id=${welfareId}`)
                            .then(response => response.json())
                            .then(result => {
                                if (result.success && result.data) {
                                    const welfare = result.data;

                                    // Generate profile picture HTML
                                    let profilePicHTML;
                                    if (welfare.member_photo && welfare.member_photo.trim() !== '') {
                                        profilePicHTML = `<img src="../Add_Members/${welfare.member_photo}" alt="${welfare.member_name}" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #10b981;">`;
                                    } else {
                                        const initials = welfare.member_name ? welfare.member_name.split(' ').map(n => n[0]).join('').toUpperCase() : 'NA';
                                        profilePicHTML = `<div style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #10b981 0%, #059669 100%); display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: bold; color: white; border: 4px solid #10b981;">${initials}</div>`;
                                    }

                                    // Create professional receipt
                                    const modalContent = `
                                        <div style="padding: 40px; background: white; max-width: 800px; margin: 0 auto;">
                                            <!-- Header -->
                                            <div style="text-align: center; border-bottom: 3px solid #10b981; padding-bottom: 20px; margin-bottom: 30px;">
                                                <h1 style="margin: 0; color: #1e293b; font-size: 32px; font-weight: 700;">WELFARE RECEIPT</h1>
                                                <p style="margin: 10px 0 0 0; color: #64748b; font-size: 16px;">Member Welfare Contribution</p>
                                            </div>

                                            <!-- Member Info with Photo -->
                                            <div style="display: flex; align-items: center; gap: 30px; margin-bottom: 30px; padding: 25px; background: linear-gradient(135deg, #f8fafc 0%, #d1fae5 100%); border-radius: 12px; border-left: 5px solid #10b981;">
                                                <div>${profilePicHTML}</div>
                                                <div style="flex: 1;">
                                                    <h2 style="margin: 0 0 10px 0; color: #1e293b; font-size: 24px;">${welfare.member_name || 'Unknown Member'}</h2>
                                                    <p style="margin: 5px 0; color: #64748b;"><strong>Email:</strong> ${welfare.member_email || 'N/A'}</p>
                                                    <p style="margin: 5px 0; color: #64748b;"><strong>Phone:</strong> ${welfare.member_phone || 'N/A'}</p>
                                                    <p style="margin: 5px 0; color: #64748b;"><strong>Address:</strong> ${welfare.member_address || 'N/A'}</p>
                                                </div>
                                            </div>

                                            <!-- Transaction Details -->
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                                                <div style="padding: 20px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                                    <p style="margin: 0 0 5px 0; color: #64748b; font-size: 14px;">Transaction ID</p>
                                                    <p style="margin: 0; color: #1e293b; font-size: 18px; font-weight: 600;">${welfare.transaction_id}</p>
                                                </div>
                                                <div style="padding: 20px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                                    <p style="margin: 0 0 5px 0; color: #64748b; font-size: 14px;">Date</p>
                                                    <p style="margin: 0; color: #1e293b; font-size: 18px; font-weight: 600;">${new Date(welfare.date).toLocaleDateString()}</p>
                                                </div>
                                                <div style="padding: 20px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                                    <p style="margin: 0 0 5px 0; color: #64748b; font-size: 14px;">Payment Method</p>
                                                    <p style="margin: 0; color: #1e293b; font-size: 18px; font-weight: 600;">${welfare.payment_method || 'Cash'}</p>
                                                </div>
                                                <div style="padding: 20px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                                    <p style="margin: 0 0 5px 0; color: #64748b; font-size: 14px;">Status</p>
                                                    <p style="margin: 0; color: #10b981; font-size: 18px; font-weight: 600;">Paid</p>
                                                </div>
                                            </div>

                                            <!-- Amount Section -->
                                            <div style="padding: 30px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px; text-align: center; margin-bottom: 30px;">
                                                <p style="margin: 0 0 10px 0; color: rgba(255,255,255,0.9); font-size: 16px; text-transform: uppercase; letter-spacing: 1px;">Total Amount Paid</p>
                                                <p style="margin: 0; color: white; font-size: 48px; font-weight: 700;">₵${parseFloat(welfare.amount).toFixed(2)}</p>
                                            </div>

                                            <!-- Notes -->
                                            ${welfare.notes ? `
                                                <div style="padding: 20px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b; margin-bottom: 30px;">
                                                    <p style="margin: 0 0 10px 0; color: #92400e; font-weight: 600;">Notes:</p>
                                                    <p style="margin: 0; color: #78350f;">${welfare.notes}</p>
                                                </div>
                                            ` : ''}

                                            <!-- Footer -->
                                            <div style="text-align: center; padding-top: 20px; border-top: 2px solid #e2e8f0;">
                                                <p style="margin: 5px 0; color: #64748b; font-size: 14px;">Thank you for your contribution to member welfare!</p>
                                                <p style="margin: 5px 0; color: #94a3b8; font-size: 12px;">Generated on ${new Date().toLocaleString()}</p>
                                            </div>

                                            <!-- Action Buttons -->
                                            <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center;">
                                                <button onclick="printWelfareReceipt()" style="padding: 12px 30px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">Print Receipt</button>
                                                <button onclick="closeWelfareReceiptModal()" style="padding: 12px 30px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600;">Close</button>
                                            </div>
                                        </div>
                                    `;

                                    // Create or update modal
                                    let modal = document.getElementById('welfareReceiptModal');
                                    if (!modal) {
                                        modal = document.createElement('div');
                                        modal.id = 'welfareReceiptModal';
                                        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 10000; overflow-y: auto; padding: 20px;';
                                        document.body.appendChild(modal);
                                    }

                                    modal.innerHTML = `<div style="background: white; border-radius: 16px; max-width: 900px; width: 100%; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);" id="welfareReceiptContent">${modalContent}</div>`;
                                    modal.style.display = 'flex';

                                    // Close on background click
                                    modal.onclick = function(e) {
                                        if (e.target === modal) {
                                            closeWelfareReceiptModal();
                                        }
                                    };
                                } else {
                                    alert('Error loading welfare details: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to load welfare details. Please try again.');
                            });
                    }

                    function closeWelfareReceiptModal() {
                        const modal = document.getElementById('welfareReceiptModal');
                        if (modal) {
                            modal.style.display = 'none';
                        }
                    }

                    function printWelfareReceipt() {
                        const content = document.getElementById('welfareReceiptContent').innerHTML;
                        const printWindow = window.open('', '', 'height=800,width=800');
                        printWindow.document.write('<html><head><title>Welfare Receipt</title>');
                        printWindow.document.write('</head><body>');
                        printWindow.document.write(content);
                        printWindow.document.write('</body></html>');
                        printWindow.document.close();
                        printWindow.print();
                    }

                    function editWelfare(welfareId) {
                        fetch(`get_finance_data.php?type=welfare_details&id=${welfareId}`)
                            .then(response => response.json())
                            .then(result => {
                                if (result.success && result.data) {
                                    const welfare = result.data;
                                    const modalContent = `
                                        <div style="padding: 30px;">
                                            <h2 style="margin-top: 0; color: #1e293b; border-bottom: 2px solid #10b981; padding-bottom: 10px;">Edit Welfare Record</h2>
                                            <form id="editWelfareForm" style="margin-top: 20px;">
                                                <input type="hidden" id="edit_welfare_transaction_id" value="${welfare.transaction_id}">
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Date <span style="color: red;">*</span></label>
                                                        <input type="date" id="edit_welfare_date" value="${welfare.date}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Amount (₵) <span style="color: red;">*</span></label>
                                                        <input type="number" step="0.01" id="edit_welfare_amount" value="${welfare.amount}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                </div>
                                                <div style="margin-top: 15px;">
                                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Payment Method <span style="color: red;">*</span></label>
                                                    <select id="edit_welfare_payment_method" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                        <option value="Cash" ${welfare.payment_method === 'Cash' ? 'selected' : ''}>Cash</option>
                                                        <option value="Mobile Money" ${welfare.payment_method === 'Mobile Money' ? 'selected' : ''}>Mobile Money</option>
                                                        <option value="Bank Transfer" ${welfare.payment_method === 'Bank Transfer' ? 'selected' : ''}>Bank Transfer</option>
                                                        <option value="Cheque" ${welfare.payment_method === 'Cheque' ? 'selected' : ''}>Cheque</option>
                                                    </select>
                                                </div>
                                                <div style="margin-top: 15px;">
                                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Notes</label>
                                                    <textarea id="edit_welfare_notes" rows="3" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; resize: vertical;">${welfare.notes || ''}</textarea>
                                                </div>
                                                <div style="margin-top: 25px; display: flex; gap: 10px; justify-content: flex-end;">
                                                    <button type="button" onclick="closeEditWelfareModal()" style="padding: 10px 24px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">Cancel</button>
                                                    <button type="submit" style="padding: 10px 24px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">Save Changes</button>
                                                </div>
                                            </form>
                                        </div>
                                    `;
                                    let modal = document.getElementById('editWelfareModal');
                                    if (!modal) {
                                        modal = document.createElement('div');
                                        modal.id = 'editWelfareModal';
                                        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000; overflow-y: auto;';
                                        document.body.appendChild(modal);
                                    }
                                    modal.innerHTML = `<div style="background: white; border-radius: 12px; max-width: 600px; width: 90%; margin: 20px auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">${modalContent}</div>`;
                                    modal.style.display = 'flex';
                                    document.getElementById('editWelfareForm').onsubmit = function(e) {
                                        e.preventDefault();
                                        const data = {
                                            transaction_id: document.getElementById('edit_welfare_transaction_id').value,
                                            date: document.getElementById('edit_welfare_date').value,
                                            amount: document.getElementById('edit_welfare_amount').value,
                                            payment_method: document.getElementById('edit_welfare_payment_method').value,
                                            notes: document.getElementById('edit_welfare_notes').value
                                        };
                                        fetch('update_welfare.php', {
                                            method: 'POST',
                                            headers: {'Content-Type': 'application/json'},
                                            body: JSON.stringify(data)
                                        })
                                        .then(response => response.json())
                                        .then(result => {
                                            if (result.success) {
                                                alert('Welfare updated successfully!');
                                                closeEditWelfareModal();
                                                updateTopWelfareStat(); // Update top overview metric
                                                updateFinanceCategoriesChart(); // Update pie chart
                                                updateFinancialTrendsChart(); // Update line chart
                                                loadWelfareContributors();
                                                loadFinancialStats();
                                                loadRecentTransactions();
                                            } else {
                                                alert('Error: ' + (result.message || 'Unknown error'));
                                            }
                                        })
                                        .catch(error => alert('Failed to update welfare.'));
                                    };
                                    modal.onclick = function(e) {
                                        if (e.target === modal) closeEditWelfareModal();
                                    };
                                }
                            })
                            .catch(error => alert('Failed to load welfare details.'));
                    }

                    function closeEditWelfareModal() {
                        const modal = document.getElementById('editWelfareModal');
                        if (modal) modal.style.display = 'none';
                    }

                    function deleteWelfare(welfareId, event) {
                        if (confirm(`Are you sure you want to delete welfare contribution ${welfareId}?\n\nThis action cannot be undone.`)) {
                            // Make API call to delete from database
                            fetch(`delete_welfare.php?id=${welfareId}`, {
                                method: 'DELETE'
                            })
                            .then(response => response.json())
                            .then(result => {
                                if (result.success) {
                                    alert(`Welfare contribution ${welfareId} deleted successfully!`);

                                    // Remove the row from the table immediately
                                    if (event) {
                                        const row = event.target.closest('tr');
                                        if (row) {
                                            row.remove();
                                        }
                                    }

                                    // Refresh all financial data
                                    updateTopWelfareStat(); // Update top overview metric
                                    updateFinanceCategoriesChart(); // Update pie chart
                                    updateFinancialTrendsChart(); // Update line chart
                                    loadFinancialStats();
                                    loadRecentTransactions();
                                    loadWelfareContributors();
                                } else {
                                    alert('Error deleting welfare contribution: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to delete welfare contribution. Please try again.');
                            });
                        }
                    }

                    // Global variable to track which filter called the custom date modal
                    let currentFilterType = null;

                    // Custom Date Range Modal Functions
                    function openCustomDateModal(filterType) {
                        currentFilterType = filterType;
                        document.getElementById('customDateModal').style.display = 'block';
                        
                        // Set default dates (last 30 days)
                        const endDate = new Date();
                        const startDate = new Date();
                        startDate.setDate(startDate.getDate() - 30);
                        
                        document.getElementById('customStartDate').value = startDate.toISOString().split('T')[0];
                        document.getElementById('customEndDate').value = endDate.toISOString().split('T')[0];
                    }

                    function closeCustomDateModal() {
                        document.getElementById('customDateModal').style.display = 'none';
                        currentFilterType = null;
                        
                        // Reset the dropdown to previous value
                        if (currentFilterType) {
                            const selectElement = getFilterSelectElement(currentFilterType);
                            if (selectElement) {
                                selectElement.value = 'month'; // Reset to default
                            }
                        }
                    }

                    function getFilterSelectElement(filterType) {
                        const selectors = {
                            'offerings': 'offeringsDateRange',
                            'project_offerings': 'projectOfferingDateRange',
                            'tithes': 'cpsDateRange',
                            'welfare': 'welfareDateRange',
                            'expenses': 'expenseDateFilter'
                        };
                        return document.getElementById(selectors[filterType]);
                    }

                    function applyCustomDateRange() {
                        const startDate = document.getElementById('customStartDate').value;
                        const endDate = document.getElementById('customEndDate').value;
                        
                        if (!startDate || !endDate) {
                            alert('Please select both start and end dates.');
                            return;
                        }
                        
                        if (new Date(startDate) > new Date(endDate)) {
                            alert('Start date must be before or equal to end date.');
                            return;
                        }
                        
                        // Close modal
                        closeCustomDateModal();
                        
                        // Apply the custom range based on filter type
                        const customRange = `custom:${startDate}:${endDate}`;
                        
                        switch(currentFilterType) {
                            case 'offerings':
                                loadOfferingsDataCustom(startDate, endDate);
                                fetchSpecialOfferings();
                                break;
                            case 'project_offerings':
                                loadProjectOfferingsDataCustom(startDate, endDate);
                                break;
                            case 'tithes':
                                loadTithesDataCustom(startDate, endDate);
                                break;
                            case 'welfare':
                                loadWelfareDataCustom(startDate, endDate);
                                break;
                            case 'expenses':
                                loadExpensesDataCustom(startDate, endDate);
                                break;
                        }
                    }

                    // Filter Functions
                    function filterCPS(range) {
                        // Handle custom range
                        if (range === 'custom') {
                            openCustomDateModal('tithes');
                            return;
                        }
                        // Load tithes data with the selected range from database
                        loadTithesData(range);
                    }

                    function filterWelfare(range) {
                        // Handle custom range
                        if (range === 'custom') {
                            openCustomDateModal('welfare');
                            return;
                        }
                        // Load welfare data with the selected range from database
                        loadWelfareData(range);
                    }

                    // Expenses Search Functionality
                    function searchExpenses(query) {
                        const table = document.getElementById('expensesList');
                        const rows = table.getElementsByClassName('eorp_exprow');
                        const searchTerm = query.toLowerCase();

                        Array.from(rows).forEach(row => {
                            const description = row.querySelector('.eorp_exptit').textContent.toLowerCase();
                            const note = row.querySelector('.eorp_expnote').textContent.toLowerCase();
                            const category = row.querySelector('.forp_cattag').textContent.toLowerCase();
                            const vendor = row.cells[3].textContent.toLowerCase();
                            const amount = row.cells[4].textContent.toLowerCase();
                            const paymentMethod = row.querySelector('.borp_paymeth').textContent.toLowerCase();

                            if (description.includes(searchTerm) || note.includes(searchTerm) ||
                                category.includes(searchTerm) || vendor.includes(searchTerm) ||
                                amount.includes(searchTerm) || paymentMethod.includes(searchTerm)) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        });
                    }

                    // Filter Expenses by Category
                    function filterExpensesByCategory() {
                        const categoryFilter = document.getElementById('expenseCategoryFilter').value;
                        const statusFilter = document.getElementById('expenseStatusFilter').value;
                        applyExpenseFilters(categoryFilter, statusFilter);
                    }

                    // Filter Expenses by Status
                    function filterExpensesByStatus() {
                        const categoryFilter = document.getElementById('expenseCategoryFilter').value;
                        const statusFilter = document.getElementById('expenseStatusFilter').value;
                        applyExpenseFilters(categoryFilter, statusFilter);
                    }

                    // Apply Combined Filters
                    function applyExpenseFilters(category, status) {
                        const table = document.getElementById('expensesList');
                        const rows = table.getElementsByClassName('eorp_exprow');

                        Array.from(rows).forEach(row => {
                            const rowCategory = row.getAttribute('data-category');
                            const rowStatus = row.getAttribute('data-status');

                            const categoryMatch = category === 'all' || rowCategory === category;
                            const statusMatch = status === 'all' || rowStatus === status;

                            if (categoryMatch && statusMatch) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        });
                    }

                    // Filter Expenses by Date
                    function filterExpensesByDate() {
                        const dateRange = document.getElementById('expenseDateFilter').value;
                        // Handle custom range
                        if (dateRange === 'custom') {
                            openCustomDateModal('expenses');
                            return;
                        }
                        // Load expenses data with the selected range from database
                        loadExpensesData(dateRange);
                    }

                    // Expense Action Functions
                    function openAddExpenseModal() {
                        alert('Opening Add New Expense form...\n\nThis would display a modal with:\n- Expense description\n- Category selection\n- Vendor/Payee\n- Amount\n- Payment method\n- Receipt upload\n- Notes');
                    }

                    function editExpense(expenseId) {
                        fetch(`get_finance_data.php?type=expense_details&id=${expenseId}`)
                            .then(response => response.json())
                            .then(result => {
                                if (result.success && result.data) {
                                    const expense = result.data;
                                    const modal = document.getElementById('editExpenseModal') || document.createElement('div');
                                    modal.id = 'editExpenseModal';
                                    modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000; overflow-y: auto;';
                                    if (!modal.parentNode) document.body.appendChild(modal);
                                    modal.innerHTML = `<div style="background: white; border-radius: 12px; max-width: 700px; width: 90%; margin: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 30px;">
                                        <h2 style="margin-top: 0; color: #1e293b; border-bottom: 2px solid #ef4444; padding-bottom: 10px;">Edit Expense</h2>
                                        <form id="editExpenseForm" style="margin-top: 20px;">
                                            <input type="hidden" id="edit_exp_transaction_id" value="${expense.transaction_id}">
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                                <div><label style="display: block; margin-bottom: 5px; font-weight: 600;">Date *</label>
                                                    <input type="date" id="edit_exp_date" value="${expense.date}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;"></div>
                                                <div><label style="display: block; margin-bottom: 5px; font-weight: 600;">Amount (₵) *</label>
                                                    <input type="number" step="0.01" id="edit_exp_amount" value="${expense.amount}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;"></div>
                                            </div>
                                            <div style="margin-top: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: 600;">Description *</label>
                                                <input type="text" id="edit_exp_description" value="${expense.description}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;"></div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                                                <div><label style="display: block; margin-bottom: 5px; font-weight: 600;">Category *</label>
                                                    <select id="edit_exp_category" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                                                        <option value="Utilities" ${expense.category === 'Utilities' ? 'selected' : ''}>Utilities</option>
                                                        <option value="Maintenance" ${expense.category === 'Maintenance' ? 'selected' : ''}>Maintenance</option>
                                                        <option value="Salaries" ${expense.category === 'Salaries' ? 'selected' : ''}>Salaries</option>
                                                        <option value="Supplies" ${expense.category === 'Supplies' ? 'selected' : ''}>Supplies</option>
                                                        <option value="Events" ${expense.category === 'Events' ? 'selected' : ''}>Events</option>
                                                        <option value="Transportation" ${expense.category === 'Transportation' ? 'selected' : ''}>Transportation</option>
                                                        <option value="Other" ${expense.category === 'Other' ? 'selected' : ''}>Other</option>
                                                    </select></div>
                                                <div><label style="display: block; margin-bottom: 5px; font-weight: 600;">Vendor/Payee</label>
                                                    <input type="text" id="edit_exp_vendor" value="${expense.vendor_payee || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;"></div>
                                            </div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                                                <div><label style="display: block; margin-bottom: 5px; font-weight: 600;">Payment Method *</label>
                                                    <select id="edit_exp_payment_method" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                                                        <option value="Cash" ${expense.payment_method === 'Cash' ? 'selected' : ''}>Cash</option>
                                                        <option value="Mobile Money" ${expense.payment_method === 'Mobile Money' ? 'selected' : ''}>Mobile Money</option>
                                                        <option value="Bank Transfer" ${expense.payment_method === 'Bank Transfer' ? 'selected' : ''}>Bank Transfer</option>
                                                        <option value="Cheque" ${expense.payment_method === 'Cheque' ? 'selected' : ''}>Cheque</option>
                                                    </select></div>
                                                <div><label style="display: block; margin-bottom: 5px; font-weight: 600;">Status *</label>
                                                    <select id="edit_exp_status" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                                                        <option value="Pending" ${expense.status === 'Pending' ? 'selected' : ''}>Pending</option>
                                                        <option value="Approved" ${expense.status === 'Approved' ? 'selected' : ''}>Approved</option>
                                                        <option value="Rejected" ${expense.status === 'Rejected' ? 'selected' : ''}>Rejected</option>
                                                    </select></div>
                                            </div>
                                            <div style="margin-top: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: 600;">Notes</label>
                                                <textarea id="edit_exp_notes" rows="2" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; resize: vertical;">${expense.notes || ''}</textarea></div>
                                            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                                                <button type="button" onclick="document.getElementById('editExpenseModal').style.display='none'" style="padding: 10px 24px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; cursor: pointer;">Cancel</button>
                                                <button type="submit" style="padding: 10px 24px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer;">Save Changes</button>
                                            </div>
                                        </form>
                                    </div>`;
                                    modal.style.display = 'flex';
                                    document.getElementById('editExpenseForm').onsubmit = function(e) {
                                        e.preventDefault();
                                        fetch('update_expense.php', {
                                            method: 'POST',
                                            headers: {'Content-Type': 'application/json'},
                                            body: JSON.stringify({
                                                transaction_id: document.getElementById('edit_exp_transaction_id').value,
                                                date: document.getElementById('edit_exp_date').value,
                                                description: document.getElementById('edit_exp_description').value,
                                                category: document.getElementById('edit_exp_category').value,
                                                vendor_payee: document.getElementById('edit_exp_vendor').value,
                                                amount: document.getElementById('edit_exp_amount').value,
                                                payment_method: document.getElementById('edit_exp_payment_method').value,
                                                status: document.getElementById('edit_exp_status').value,
                                                notes: document.getElementById('edit_exp_notes').value
                                            })
                                        })
                                        .then(response => response.json())
                                        .then(result => {
                                            if (result.success) {
                                                alert('Expense updated successfully!');
                                                modal.style.display = 'none';
                                                updateFinancialTrendsChart(); // Update line chart (expenses affect trends)
                                                loadExpenses();
                                                loadFinancialStats();
                                                loadRecentTransactions();
                                            } else {
                                                alert('Error: ' + (result.message || 'Unknown error'));
                                            }
                                        })
                                        .catch(error => alert('Failed to update expense.'));
                                    };
                                    modal.onclick = function(e) {
                                        if (e.target === modal) modal.style.display = 'none';
                                    };
                                }
                            })
                            .catch(error => alert('Failed to load expense details.'));
                    }

                    function deleteExpense(expenseId, event) {
                        if (confirm(`Are you sure you want to delete expense ${expenseId}?\n\nThis action cannot be undone.`)) {
                            // Make API call to delete from database
                            fetch(`delete_expense.php?id=${expenseId}`, {
                                method: 'DELETE'
                            })
                            .then(response => response.json())
                            .then(result => {
                                if (result.success) {
                                    alert(`Expense ${expenseId} deleted successfully!`);

                                    // Remove the row from the table immediately
                                    if (event) {
                                        const row = event.target.closest('tr');
                                        if (row) {
                                            row.remove();
                                        }
                                    }

                                    // Refresh all financial data
                                    updateFinancialTrendsChart(); // Update line chart (expenses affect trends)
                                    loadFinancialStats();
                                    loadRecentTransactions();
                                    loadExpenses();
                                } else {
                                    alert('Error deleting expense: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to delete expense. Please try again.');
                            });
                        }
                    }

                    

                    function approveExpense(expenseId) {
                        if (confirm(`Approve expense ${expenseId}?`)) {
                            alert(`Expense ${expenseId} approved successfully!`);
                            // Update the status badge to approved
                            const row = event.target.closest('tr');
                            const statusBadge = row.querySelector('.borp_statbadge');
                            statusBadge.className = 'borp_statbadge forp_statapp';
                            statusBadge.textContent = 'Approved';

                            // Replace approve/reject buttons with edit/delete
                            const actionButtons = row.querySelector('.gorp_actbtns');
                            actionButtons.innerHTML = `
                                    <button class="borp_acticon" onclick="editExpense('${expenseId}')" title="Edit">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                        </svg>
                                    </button>
                                    <button class="borp_acticon gorp_delbtn" onclick="deleteExpense('${expenseId}', event)" title="Delete">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="3 6 5 6 21 6"></polyline>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                        </svg>
                                    </button>
                                `;
                        }
                    }

                    function rejectExpense(expenseId) {
                        const reason = prompt(`Enter reason for rejecting expense ${expenseId}:`);
                        if (reason) {
                            alert(`Expense ${expenseId} rejected.\nReason: ${reason}`);
                            // Update the status badge to rejected
                            const row = event.target.closest('tr');
                            const statusBadge = row.querySelector('.borp_statbadge');
                            statusBadge.className = 'borp_statbadge forp_statsrej';
                            statusBadge.textContent = 'Rejected';
                        }
                    }

                    function viewReceipt(expenseId) {
                        alert(`Viewing receipt for expense ${expenseId}...\n\nThis would display the uploaded receipt image or PDF.`);
                    }

                    function exportExpenses() {
                        alert('Exporting expenses to CSV/Excel...\n\nThis would download a file with all expense records based on current filters.');
                    }

                    function printExpenses() {
                        alert('Printing expenses report...\n\nThis would open a print-friendly view of the expense records.');
                    }

                    // Offerings Management Functions
                    function searchOfferings(query) {
                        const table = document.getElementById('offeringsList');
                        const rows = table.getElementsByClassName('eorp_exprow');
                        const searchTerm = query.toLowerCase();

                        Array.from(rows).forEach(row => {
                            const date = row.cells[0].textContent.toLowerCase();
                            const serviceType = row.querySelector('.eorp_exptit').textContent.toLowerCase();
                            const time = row.cells[2].textContent.toLowerCase();
                            const amount = row.cells[3].textContent.toLowerCase();
                            const countedBy = row.cells[5].textContent.toLowerCase();

                            if (date.includes(searchTerm) || serviceType.includes(searchTerm) ||
                                time.includes(searchTerm) || amount.includes(searchTerm) ||
                                countedBy.includes(searchTerm)) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        });
                    }

                    function addOffering() {
                        alert('Opening Add Offering form...\n\nFields:\n- Service Date & Time\n- Service Type\n- Amount Collected\n- Collection Method\n- Counted By\n- Notes');
                    }

                    function viewOfferingDetails(offeringId) {
                        // Find the offering data from the loaded offerings
                        fetch(`get_finance_data.php?type=offering_details&id=${offeringId}`)
                            .then(response => response.json())
                            .then(result => {
                                if (result.success && result.data) {
                                    const offering = result.data;
                                    
                                    // Create modal content
                                    const modalContent = `
                                        <div style="padding: 20px;">
                                            <h2 style="margin-top: 0; color: #1e293b; border-bottom: 2px solid #5B4FDE; padding-bottom: 10px;">Offering Details</h2>
                                            
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                                                <div>
                                                    <p style="margin: 10px 0;"><strong>Transaction ID:</strong> ${offering.transaction_id}</p>
                                                    <p style="margin: 10px 0;"><strong>Date:</strong> ${new Date(offering.date).toLocaleDateString()}</p>
                                                    <p style="margin: 10px 0;"><strong>Service Type:</strong> ${offering.service_type}</p>
                                                    <p style="margin: 10px 0;"><strong>Service Time:</strong> ${offering.service_time || 'N/A'}</p>
                                                </div>
                                                <div>
                                                    <p style="margin: 10px 0;"><strong>Amount Collected:</strong> <span style="color: #10b981; font-size: 1.2em;">₵${parseFloat(offering.amount_collected).toFixed(2)}</span></p>
                                                    <p style="margin: 10px 0;"><strong>Collection Method:</strong> ${offering.collection_method}</p>
                                                    <p style="margin: 10px 0;"><strong>Counted By:</strong> ${offering.counted_by || 'N/A'}</p>
                                                    <p style="margin: 10px 0;"><strong>Status:</strong> <span style="background: #10b981; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.875em;">${offering.status}</span></p>
                                                </div>
                                            </div>
                                            
                                            <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px;">
                                                <p style="margin: 5px 0;"><strong>Notes:</strong></p>
                                                <p style="margin: 10px 0; color: #64748b;">${offering.notes || 'No notes recorded'}</p>
                                            </div>
                                            
                                            <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                                                <p style="margin: 5px 0;"><strong>Record Information:</strong></p>
                                                <p style="margin: 5px 0; font-size: 0.875em; color: #92400e;">Created: ${new Date(offering.created_at).toLocaleString()}</p>
                                                <p style="margin: 5px 0; font-size: 0.875em; color: #92400e;">Last Updated: ${new Date(offering.updated_at).toLocaleString()}</p>
                                            </div>
                                            
                                            <div style="margin-top: 20px; text-align: right;">
                                                <button onclick="closeOfferingDetailsModal()" style="padding: 10px 24px; background: #5B4FDE; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">Close</button>
                                            </div>
                                        </div>
                                    `;
                                    
                                    // Create or update modal
                                    let modal = document.getElementById('offeringDetailsModal');
                                    if (!modal) {
                                        modal = document.createElement('div');
                                        modal.id = 'offeringDetailsModal';
                                        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;';
                                        document.body.appendChild(modal);
                                    }
                                    
                                    modal.innerHTML = `<div style="background: white; border-radius: 12px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">${modalContent}</div>`;
                                    modal.style.display = 'flex';
                                    
                                    // Close on background click
                                    modal.onclick = function(e) {
                                        if (e.target === modal) {
                                            closeOfferingDetailsModal();
                                        }
                                    };
                                } else {
                                    alert('Error loading offering details: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to load offering details. Please try again.');
                            });
                    }
                    
                    function closeOfferingDetailsModal() {
                        const modal = document.getElementById('offeringDetailsModal');
                        if (modal) {
                            modal.style.display = 'none';
                        }
                    }

                    function editOffering(offeringId) {
                        // Fetch the offering details first
                        fetch(`get_finance_data.php?type=offering_details&id=${offeringId}`)
                            .then(response => response.json())
                            .then(result => {
                                if (result.success && result.data) {
                                    const offering = result.data;
                                    
                                    // Create edit modal with form
                                    const modalContent = `
                                        <div style="padding: 30px;">
                                            <h2 style="margin-top: 0; color: #1e293b; border-bottom: 2px solid #5B4FDE; padding-bottom: 10px;">Edit Offering Record</h2>
                                            
                                            <form id="editOfferingForm" style="margin-top: 20px;">
                                                <input type="hidden" id="edit_transaction_id" value="${offering.transaction_id}">
                                                
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Date <span style="color: red;">*</span></label>
                                                        <input type="date" id="edit_date" value="${offering.date}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                    
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Service Time</label>
                                                        <input type="time" id="edit_service_time" value="${offering.service_time || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                </div>
                                                
                                                <div style="margin-top: 15px;">
                                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Service Type <span style="color: red;">*</span></label>
                                                    <input type="text" id="edit_service_type" value="${offering.service_type}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                </div>
                                                
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Amount Collected (₵) <span style="color: red;">*</span></label>
                                                        <input type="number" step="0.01" id="edit_amount" value="${offering.amount_collected}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                    
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Collection Method <span style="color: red;">*</span></label>
                                                        <select id="edit_collection_method" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                            <option value="Cash" ${offering.collection_method === 'Cash' ? 'selected' : ''}>Cash</option>
                                                            <option value="Mobile Money" ${offering.collection_method === 'Mobile Money' ? 'selected' : ''}>Mobile Money</option>
                                                            <option value="Bank Transfer" ${offering.collection_method === 'Bank Transfer' ? 'selected' : ''}>Bank Transfer</option>
                                                            <option value="Cash & Mobile" ${offering.collection_method === 'Cash & Mobile' ? 'selected' : ''}>Cash & Mobile</option>
                                                            <option value="Mixed" ${offering.collection_method === 'Mixed' ? 'selected' : ''}>Mixed</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Counted By</label>
                                                        <input type="text" id="edit_counted_by" value="${offering.counted_by || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                    
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Status <span style="color: red;">*</span></label>
                                                        <select id="edit_status" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                            <option value="Verified" ${offering.status === 'Verified' ? 'selected' : ''}>Verified</option>
                                                            <option value="Pending" ${offering.status === 'Pending' ? 'selected' : ''}>Pending</option>
                                                            <option value="Deposited" ${offering.status === 'Deposited' ? 'selected' : ''}>Deposited</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                
                                                <div style="margin-top: 15px;">
                                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Notes</label>
                                                    <textarea id="edit_notes" rows="3" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; resize: vertical;">${offering.notes || ''}</textarea>
                                                </div>
                                                
                                                <div style="margin-top: 25px; display: flex; gap: 10px; justify-content: flex-end;">
                                                    <button type="button" onclick="closeEditOfferingModal()" style="padding: 10px 24px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">Cancel</button>
                                                    <button type="submit" style="padding: 10px 24px; background: #5B4FDE; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">Save Changes</button>
                                                </div>
                                            </form>
                                        </div>
                                    `;
                                    
                                    // Create or update modal
                                    let modal = document.getElementById('editOfferingModal');
                                    if (!modal) {
                                        modal = document.createElement('div');
                                        modal.id = 'editOfferingModal';
                                        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000; overflow-y: auto;';
                                        document.body.appendChild(modal);
                                    }
                                    
                                    modal.innerHTML = `<div style="background: white; border-radius: 12px; max-width: 700px; width: 90%; margin: 20px auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">${modalContent}</div>`;
                                    modal.style.display = 'flex';
                                    
                                    // Handle form submission
                                    document.getElementById('editOfferingForm').onsubmit = function(e) {
                                        e.preventDefault();
                                        saveOfferingChanges();
                                    };
                                    
                                    // Close on background click
                                    modal.onclick = function(e) {
                                        if (e.target === modal) {
                                            closeEditOfferingModal();
                                        }
                                    };
                                } else {
                                    alert('Error loading offering details: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to load offering details. Please try again.');
                            });
                    }
                    
                    function closeEditOfferingModal() {
                        const modal = document.getElementById('editOfferingModal');
                        if (modal) {
                            modal.style.display = 'none';
                        }
                    }
                    
                    function saveOfferingChanges() {
                        // Get form values
                        const data = {
                            transaction_id: document.getElementById('edit_transaction_id').value,
                            date: document.getElementById('edit_date').value,
                            service_type: document.getElementById('edit_service_type').value,
                            service_time: document.getElementById('edit_service_time').value,
                            amount_collected: document.getElementById('edit_amount').value,
                            collection_method: document.getElementById('edit_collection_method').value,
                            counted_by: document.getElementById('edit_counted_by').value,
                            status: document.getElementById('edit_status').value,
                            notes: document.getElementById('edit_notes').value
                        };
                        
                        // Send update request
                        fetch('update_offering.php', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data)
                        })
                        .then(response => response.json())
                        .then(result => {
                            if (result.success) {
                                alert('Offering updated successfully!');
                                closeEditOfferingModal();
                                // Reload offerings data and update metrics
                                updateOfferingsSummary(); // Update offerings section metrics
                                updateTopOfferingsStat(); // Update top overview metric
                                updateFinanceCategoriesChart(); // Update pie chart
                                updateFinancialTrendsChart(); // Update line chart
                                loadOfferingsData('month');
                            } else {
                                alert('Error updating offering: ' + (result.message || 'Unknown error'));
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('Failed to update offering. Please try again.');
                        });
                    }

                    function deleteOffering(offeringId, event) {
                        if (confirm(`Are you sure you want to delete offering record ${offeringId}?\n\nThis action cannot be undone.`)) {
                            // Make API call to delete from database
                            fetch(`delete_offering.php?id=${offeringId}`, {
                                method: 'DELETE'
                            })
                            .then(response => response.json())
                            .then(result => {
                                if (result.success) {
                                    alert('Offering record deleted successfully!');

                                    // Remove the row from the table immediately
                                    if (event) {
                                        const row = event.target.closest('tr');
                                        if (row) {
                                            row.remove();
                                        }
                                    }

                                    // Refresh all financial data
                                    updateOfferingsSummary(); // Update offerings section metrics
                                    updateTopOfferingsStat(); // Update top overview metric
                                    updateFinanceCategoriesChart(); // Update pie chart
                                    updateFinancialTrendsChart(); // Update line chart
                                    loadFinancialStats();
                                    loadRecentTransactions();
                                    loadOfferingsData('month');
                                    fetchSpecialOfferings();
                                } else {
                                    alert('Error deleting offering: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to delete offering. Please try again.');
                            });
                        }
                    }

                    function exportOfferings() {
                        alert('Exporting offerings data to Excel...\n\nIncluding all records based on current date filter.');
                    }

                    // Offerings Filter Function
                    function filterOfferings(range) {
                        // Handle custom range
                        if (range === 'custom') {
                            openCustomDateModal('offerings');
                            return;
                        }

                        // Reload offerings data with the selected range
                        loadOfferingsData(range);
                        fetchSpecialOfferingsForRange(range);
                    }

                    // Project Offerings Management Functions
                    function searchProjectOfferings(query) {
                        const table = document.getElementById('projectOfferingsList');
                        const rows = table.getElementsByClassName('eorp_exprow');
                        const searchTerm = query.toLowerCase();

                        Array.from(rows).forEach(row => {
                            const date = row.cells[0].textContent.toLowerCase();
                            const serviceType = row.querySelector('.eorp_exptit').textContent.toLowerCase();
                            const time = row.cells[2].textContent.toLowerCase();
                            const amount = row.cells[3].textContent.toLowerCase();
                            const countedBy = row.cells[5].textContent.toLowerCase();

                            if (date.includes(searchTerm) || serviceType.includes(searchTerm) ||
                                time.includes(searchTerm) || amount.includes(searchTerm) ||
                                countedBy.includes(searchTerm)) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        });
                    }

                    function addProjectOffering() {
                        alert('Opening Add Project Offering form...\n\nFields:\n- Service Date & Time\n- Project Type\n- Amount Collected\n- Collection Method\n- Counted By\n- Notes');
                    }

                    function viewProjectOfferingDetails(offeringId) {
                        // Fetch project offering data from database
                        fetch(`get_finance_data.php?type=project_offering_details&id=${offeringId}`)
                            .then(response => response.json())
                            .then(result => {
                                if (result.success && result.data) {
                                    const offering = result.data;
                                    
                                    const modalContent = `
                                        <div style="padding: 20px;">
                                            <h2 style="margin-top: 0; color: #1e293b; border-bottom: 2px solid #5B4FDE; padding-bottom: 10px;">Project Offering Details</h2>
                                            
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                                                <div>
                                                    <p style="margin: 10px 0;"><strong>Transaction ID:</strong> ${offering.transaction_id}</p>
                                                    <p style="margin: 10px 0;"><strong>Date:</strong> ${new Date(offering.date).toLocaleDateString()}</p>
                                                    <p style="margin: 10px 0;"><strong>Service Type:</strong> ${offering.service_type}</p>
                                                    <p style="margin: 10px 0;"><strong>Service Time:</strong> ${offering.service_time || 'N/A'}</p>
                                                    <p style="margin: 10px 0;"><strong>Project Name:</strong> <span style="color: #5B4FDE; font-weight: 600;">${offering.project_name}</span></p>
                                                </div>
                                                <div>
                                                    <p style="margin: 10px 0;"><strong>Amount Collected:</strong> <span style="color: #10b981; font-size: 1.2em;">₵${parseFloat(offering.amount_collected).toFixed(2)}</span></p>
                                                    <p style="margin: 10px 0;"><strong>Collection Method:</strong> ${offering.collection_method}</p>
                                                    <p style="margin: 10px 0;"><strong>Counted By:</strong> ${offering.counted_by || 'N/A'}</p>
                                                    <p style="margin: 10px 0;"><strong>Status:</strong> <span style="background: #10b981; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.875em;">${offering.status}</span></p>
                                                </div>
                                            </div>
                                            
                                            <div style="margin-top: 20px; padding: 15px; background: #ede9fe; border-radius: 8px;">
                                                <p style="margin: 5px 0;"><strong>Project Description:</strong></p>
                                                <p style="margin: 10px 0; color: #5b21b6;">${offering.project_description || 'No description provided'}</p>
                                            </div>
                                            
                                            <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                                                <p style="margin: 5px 0;"><strong>Record Information:</strong></p>
                                                <p style="margin: 5px 0; font-size: 0.875em; color: #92400e;">Created: ${new Date(offering.created_at).toLocaleString()}</p>
                                                <p style="margin: 5px 0; font-size: 0.875em; color: #92400e;">Last Updated: ${new Date(offering.updated_at).toLocaleString()}</p>
                                            </div>
                                            
                                            <div style="margin-top: 20px; text-align: right;">
                                                <button onclick="closeProjectOfferingDetailsModal()" style="padding: 10px 24px; background: #5B4FDE; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">Close</button>
                                            </div>
                                        </div>
                                    `;
                                    
                                    let modal = document.getElementById('projectOfferingDetailsModal');
                                    if (!modal) {
                                        modal = document.createElement('div');
                                        modal.id = 'projectOfferingDetailsModal';
                                        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;';
                                        document.body.appendChild(modal);
                                    }
                                    
                                    modal.innerHTML = `<div style="background: white; border-radius: 12px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">${modalContent}</div>`;
                                    modal.style.display = 'flex';
                                    
                                    modal.onclick = function(e) {
                                        if (e.target === modal) {
                                            closeProjectOfferingDetailsModal();
                                        }
                                    };
                                } else {
                                    alert('Error loading project offering details: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to load project offering details. Please try again.');
                            });
                    }
                    
                    function closeProjectOfferingDetailsModal() {
                        const modal = document.getElementById('projectOfferingDetailsModal');
                        if (modal) {
                            modal.style.display = 'none';
                        }
                    }

                    function editProjectOffering(offeringId) {
                        // Fetch the project offering details first
                        fetch(`get_finance_data.php?type=project_offering_details&id=${offeringId}`)
                            .then(response => response.json())
                            .then(result => {
                                if (result.success && result.data) {
                                    const offering = result.data;
                                    
                                    // Create edit modal with form
                                    const modalContent = `
                                        <div style="padding: 30px;">
                                            <h2 style="margin-top: 0; color: #1e293b; border-bottom: 2px solid #5B4FDE; padding-bottom: 10px;">Edit Project Offering Record</h2>
                                            
                                            <form id="editProjectOfferingForm" style="margin-top: 20px;">
                                                <input type="hidden" id="edit_proj_transaction_id" value="${offering.transaction_id}">
                                                
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Date <span style="color: red;">*</span></label>
                                                        <input type="date" id="edit_proj_date" value="${offering.date}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                    
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Service Time</label>
                                                        <input type="time" id="edit_proj_service_time" value="${offering.service_time || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                </div>
                                                
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Service Type <span style="color: red;">*</span></label>
                                                        <input type="text" id="edit_proj_service_type" value="${offering.service_type}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                    
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Project Name <span style="color: red;">*</span></label>
                                                        <input type="text" id="edit_proj_project_name" value="${offering.project_name}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                </div>
                                                
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Amount Collected (₵) <span style="color: red;">*</span></label>
                                                        <input type="number" step="0.01" id="edit_proj_amount" value="${offering.amount_collected}" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                    
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Collection Method <span style="color: red;">*</span></label>
                                                        <select id="edit_proj_collection_method" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                            <option value="Cash" ${offering.collection_method === 'Cash' ? 'selected' : ''}>Cash</option>
                                                            <option value="Mobile Money" ${offering.collection_method === 'Mobile Money' ? 'selected' : ''}>Mobile Money</option>
                                                            <option value="Bank Transfer" ${offering.collection_method === 'Bank Transfer' ? 'selected' : ''}>Bank Transfer</option>
                                                            <option value="Cash & Mobile" ${offering.collection_method === 'Cash & Mobile' ? 'selected' : ''}>Cash & Mobile</option>
                                                            <option value="Mixed" ${offering.collection_method === 'Mixed' ? 'selected' : ''}>Mixed</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                
                                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Counted By</label>
                                                        <input type="text" id="edit_proj_counted_by" value="${offering.counted_by || ''}" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                    </div>
                                                    
                                                    <div>
                                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Status <span style="color: red;">*</span></label>
                                                        <select id="edit_proj_status" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                                            <option value="Verified" ${offering.status === 'Verified' ? 'selected' : ''}>Verified</option>
                                                            <option value="Pending" ${offering.status === 'Pending' ? 'selected' : ''}>Pending</option>
                                                            <option value="Deposited" ${offering.status === 'Deposited' ? 'selected' : ''}>Deposited</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                
                                                <div style="margin-top: 15px;">
                                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Project Description</label>
                                                    <textarea id="edit_proj_project_description" rows="3" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; resize: vertical;">${offering.project_description || ''}</textarea>
                                                </div>
                                                
                                                <div style="margin-top: 25px; display: flex; gap: 10px; justify-content: flex-end;">
                                                    <button type="button" onclick="closeEditProjectOfferingModal()" style="padding: 10px 24px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">Cancel</button>
                                                    <button type="submit" style="padding: 10px 24px; background: #5B4FDE; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">Save Changes</button>
                                                </div>
                                            </form>
                                        </div>
                                    `;
                                    
                                    // Create or update modal
                                    let modal = document.getElementById('editProjectOfferingModal');
                                    if (!modal) {
                                        modal = document.createElement('div');
                                        modal.id = 'editProjectOfferingModal';
                                        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000; overflow-y: auto;';
                                        document.body.appendChild(modal);
                                    }
                                    
                                    modal.innerHTML = `<div style="background: white; border-radius: 12px; max-width: 700px; width: 90%; margin: 20px auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">${modalContent}</div>`;
                                    modal.style.display = 'flex';
                                    
                                    // Handle form submission
                                    document.getElementById('editProjectOfferingForm').onsubmit = function(e) {
                                        e.preventDefault();
                                        saveProjectOfferingChanges();
                                    };
                                    
                                    // Close on background click
                                    modal.onclick = function(e) {
                                        if (e.target === modal) {
                                            closeEditProjectOfferingModal();
                                        }
                                    };
                                } else {
                                    alert('Error loading project offering details: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to load project offering details. Please try again.');
                            });
                    }
                    
                    function closeEditProjectOfferingModal() {
                        const modal = document.getElementById('editProjectOfferingModal');
                        if (modal) {
                            modal.style.display = 'none';
                        }
                    }
                    
                    function saveProjectOfferingChanges() {
                        // Get form values
                        const data = {
                            transaction_id: document.getElementById('edit_proj_transaction_id').value,
                            date: document.getElementById('edit_proj_date').value,
                            service_type: document.getElementById('edit_proj_service_type').value,
                            service_time: document.getElementById('edit_proj_service_time').value,
                            project_name: document.getElementById('edit_proj_project_name').value,
                            amount_collected: document.getElementById('edit_proj_amount').value,
                            collection_method: document.getElementById('edit_proj_collection_method').value,
                            counted_by: document.getElementById('edit_proj_counted_by').value,
                            status: document.getElementById('edit_proj_status').value,
                            project_description: document.getElementById('edit_proj_project_description').value
                        };
                        
                        // Send update request
                        fetch('update_project_offering.php', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data)
                        })
                        .then(response => response.json())
                        .then(result => {
                            if (result.success) {
                                alert('Project offering updated successfully!');
                                closeEditProjectOfferingModal();
                                // Reload project offerings data and update metrics
                                updateProjectOfferingsSummary(); // Update project offerings section metrics
                                updateTopProjectOfferingsStat(); // Update top overview metric
                                updateFinanceCategoriesChart(); // Update pie chart
                                updateFinancialTrendsChart(); // Update line chart
                                loadProjectOfferingsData('month');
                            } else {
                                alert('Error updating project offering: ' + (result.message || 'Unknown error'));
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('Failed to update project offering. Please try again.');
                        });
                    }

                    function deleteProjectOffering(offeringId, event) {
                        if (confirm(`Are you sure you want to delete project offering record ${offeringId}?\n\nThis action cannot be undone.`)) {
                            // Make API call to delete from database
                            fetch(`delete_project_offering.php?id=${offeringId}`, {
                                method: 'DELETE'
                            })
                            .then(response => response.json())
                            .then(result => {
                                if (result.success) {
                                    alert('Project offering record deleted successfully!');

                                    // Remove the row from the table immediately
                                    if (event) {
                                        const row = event.target.closest('tr');
                                        if (row) {
                                            row.remove();
                                        }
                                    }

                                    // Refresh all financial data
                                    updateProjectOfferingsSummary(); // Update project offerings section metrics
                                    updateTopProjectOfferingsStat(); // Update top overview metric
                                    updateFinanceCategoriesChart(); // Update pie chart
                                    updateFinancialTrendsChart(); // Update line chart
                                    loadFinancialStats();
                                    loadRecentTransactions();
                                    loadProjectOfferingsData('month');
                                } else {
                                    alert('Error deleting project offering: ' + (result.message || 'Unknown error'));
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Failed to delete project offering. Please try again.');
                            });
                        }
                    }

                    function exportProjectOfferings() {
                        alert('Exporting project offerings data to Excel...\n\nIncluding all records based on current date filter.');
                    }

                    // Project Offerings Filter Function
                    function filterProjectOfferings(range) {
                        // Handle custom range
                        if (range === 'custom') {
                            openCustomDateModal('project_offerings');
                            return;
                        }
                        
                        // Reload project offerings data with the selected range
                        loadProjectOfferingsData(range);
                    }

                    // CPS Filter Function (duplicate removed - uses function at line 2504)
                    // This duplicate function has been removed to use the one defined earlier

                    // ========================================
                    // MEMBER PAYMENT HISTORY FUNCTIONS
                    // ========================================

                    // Store all members in memory for autocomplete
                    let allMembers = [];

                    // Load all members for autocomplete search
                    function loadMembersForDropdown() {
                        fetch('get_member_payments.php?action=get_members')
                            .then(response => response.json())
                            .then(result => {
                                if (result.success && result.data) {
                                    allMembers = result.data;
                                    console.log(`Loaded ${allMembers.length} members for search`);
                                } else {
                                    console.error('Failed to load members:', result.message);
                                }
                            })
                            .catch(error => {
                                console.error('Error loading members:', error);
                            });
                    }

                    // Search members by name (autocomplete)
                    function searchMembers(query) {
                        const suggestionsDiv = document.getElementById('memberSuggestions');
                        
                        if (!query || query.trim().length < 1) {
                            suggestionsDiv.style.display = 'none';
                            return;
                        }
                        
                        const searchTerm = query.toLowerCase();
                        const filtered = allMembers.filter(member => 
                            member.full_name.toLowerCase().includes(searchTerm) ||
                            (member.email && member.email.toLowerCase().includes(searchTerm)) ||
                            (member.phone && member.phone.includes(searchTerm))
                        );
                        
                        if (filtered.length === 0) {
                            suggestionsDiv.innerHTML = '<div style="padding: 12px; text-align: center; color: #9ca3af; font-size: 14px;">No members found</div>';
                            suggestionsDiv.style.display = 'block';
                            return;
                        }
                        
                        // Show top 10 results
                        const resultsToShow = filtered.slice(0, 10);
                        suggestionsDiv.innerHTML = resultsToShow.map(member => {
                            const initials = member.full_name.split(' ').map(n => n[0]).join('').toUpperCase();
                            
                            // Display profile picture if available, otherwise show initials
                            let avatarHTML;
                            if (member.photo_path && member.photo_path !== 'NULL' && member.photo_path.trim() !== '') {
                                avatarHTML = `<img src="../Add_Members/${member.photo_path}" alt="${member.full_name}" style="width: 36px; height: 36px; border-radius: 50%; object-fit: cover; border: 2px solid #e5e7eb;" onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\\'width: 36px; height: 36px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 13px;\\'>${initials}</div>';">`;
                            } else {
                                avatarHTML = `<div style="width: 36px; height: 36px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 13px;">${initials}</div>`;
                            }
                            
                            return `
                                <div 
                                    onclick="selectMember(${member.id}, '${member.full_name.replace(/'/g, "\\'")}', '${member.email || ''}', '${member.phone || ''}')" 
                                    style="padding: 12px; cursor: pointer; border-bottom: 1px solid #f3f4f6; display: flex; align-items: center; gap: 12px; transition: background 0.2s;"
                                    onmouseover="this.style.background='#f9fafb'"
                                    onmouseout="this.style.background='white'">
                                    ${avatarHTML}
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #111827; font-size: 14px;">${member.full_name}</div>
                                        <div style="font-size: 12px; color: #6b7280;">${member.email || member.phone || 'No contact info'}</div>
                                    </div>
                                </div>
                            `;
                        }).join('');
                        
                        suggestionsDiv.style.display = 'block';
                    }

                    // Show all members when input is focused
                    function showMemberSuggestions() {
                        const input = document.getElementById('memberSearchInput');
                        if (input.value.trim().length === 0 && allMembers.length > 0) {
                            searchMembers(''); // Will show "start typing" message
                            const suggestionsDiv = document.getElementById('memberSuggestions');
                            suggestionsDiv.innerHTML = '<div style="padding: 12px; text-align: center; color: #6b7280; font-size: 13px;">Start typing to search members...</div>';
                            suggestionsDiv.style.display = 'block';
                        }
                    }

                    // Select a member from suggestions
                    function selectMember(id, name, email, phone) {
                        document.getElementById('memberSearchInput').value = name;
                        document.getElementById('selectedMemberId').value = id;
                        document.getElementById('memberSuggestions').style.display = 'none';
                        
                        console.log(`Selected member: ${name} (ID: ${id})`);
                    }

                    // Close suggestions when clicking outside
                    document.addEventListener('click', function(e) {
                        const searchInput = document.getElementById('memberSearchInput');
                        const suggestionsDiv = document.getElementById('memberSuggestions');
                        
                        if (searchInput && suggestionsDiv && 
                            !searchInput.contains(e.target) && 
                            !suggestionsDiv.contains(e.target)) {
                            suggestionsDiv.style.display = 'none';
                        }
                    });

                    // Switch between Tithe and Welfare tabs
                    function switchPaymentTab(tab) {
                        const titheSection = document.getElementById('titheRecordsSection');
                        const welfareSection = document.getElementById('welfareRecordsSection');
                        const titheBtn = document.getElementById('titheTabBtn');
                        const welfareBtn = document.getElementById('welfareTabBtn');
                        
                        if (tab === 'tithe') {
                            titheSection.style.display = 'block';
                            welfareSection.style.display = 'none';
                            titheBtn.style.background = '#2563eb';
                            titheBtn.style.color = 'white';
                            titheBtn.style.fontWeight = '600';
                            welfareBtn.style.background = '#f3f4f6';
                            welfareBtn.style.color = '#6b7280';
                            welfareBtn.style.fontWeight = '500';
                        } else if (tab === 'welfare') {
                            titheSection.style.display = 'none';
                            welfareSection.style.display = 'block';
                            welfareBtn.style.background = '#2563eb';
                            welfareBtn.style.color = 'white';
                            welfareBtn.style.fontWeight = '600';
                            titheBtn.style.background = '#f3f4f6';
                            titheBtn.style.color = '#6b7280';
                            titheBtn.style.fontWeight = '500';
                        }
                    }

                    // Clear member payment history view
                    function clearMemberPaymentHistory() {
                        // Hide all sections
                        document.getElementById('memberInfoCard').style.display = 'none';
                        document.getElementById('paymentSummaryCards').style.display = 'none';
                        document.getElementById('paymentRecordsTables').style.display = 'none';
                        document.getElementById('emptyState').style.display = 'block';
                        
                        // Clear form
                        document.getElementById('memberSearchInput').value = '';
                        document.getElementById('selectedMemberId').value = '';
                        document.getElementById('startDate').value = '';
                        document.getElementById('endDate').value = '';
                        
                        console.log('✨ Cleared member payment history view');
                    }

                    // Set date range based on quick filter
                    function setDateRange(range) {
                        const today = new Date();
                        const startDateInput = document.getElementById('startDate');
                        const endDateInput = document.getElementById('endDate');
                        
                        let startDate, endDate;
                        
                        switch(range) {
                            case 'today':
                                startDate = endDate = today.toISOString().split('T')[0];
                                break;
                            case 'week':
                                startDate = new Date(today.setDate(today.getDate() - today.getDay())).toISOString().split('T')[0];
                                endDate = new Date().toISOString().split('T')[0];
                                break;
                            case 'month':
                                startDate = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];
                                endDate = new Date().toISOString().split('T')[0];
                                break;
                            case 'year':
                                startDate = new Date(today.getFullYear(), 0, 1).toISOString().split('T')[0];
                                endDate = new Date().toISOString().split('T')[0];
                                break;
                            case 'all':
                                startDate = '';
                                endDate = '';
                                break;
                        }
                        
                        startDateInput.value = startDate;
                        endDateInput.value = endDate;
                    }

                    // Load member payment history
                    function loadMemberPaymentHistory() {
                        const memberId = document.getElementById('selectedMemberId').value;
                        const memberName = document.getElementById('memberSearchInput').value;
                        const startDate = document.getElementById('startDate').value;
                        const endDate = document.getElementById('endDate').value;
                        
                        console.log('🔍 Loading payment history for:', {
                            memberId, 
                            memberName, 
                            startDate, 
                            endDate
                        });
                        
                        if (!memberId) {
                            alert('Please search and select a member first');
                            return;
                        }
                        
                        // Build query parameters
                        let queryParams = `action=get_payment_history&member_id=${memberId}`;
                        if (startDate) queryParams += `&start_date=${startDate}`;
                        if (endDate) queryParams += `&end_date=${endDate}`;
                        
                        console.log('📡 API URL:', `get_member_payments.php?${queryParams}`);
                        
                        // Show loading state
                        document.getElementById('emptyState').style.display = 'none';
                        document.getElementById('memberInfoCard').style.display = 'none';
                        document.getElementById('paymentSummaryCards').style.display = 'none';
                        document.getElementById('paymentRecordsTables').style.display = 'none';
                        
                        fetch(`get_member_payments.php?${queryParams}`)
                            .then(response => {
                                console.log('📥 Response status:', response.status);
                                return response.text();
                            })
                            .then(text => {
                                console.log('📄 Raw response:', text);
                                try {
                                    const result = JSON.parse(text);
                                    console.log('✅ Parsed result:', result);
                                    
                                    if (result.success && result.data) {
                                        displayMemberPaymentHistory(result.data, startDate, endDate);
                                    } else {
                                        console.error('❌ API Error:', result.message);
                                        alert('Error: ' + (result.message || 'Failed to load payment history'));
                                        document.getElementById('emptyState').style.display = 'block';
                                    }
                                } catch (e) {
                                    console.error('❌ JSON Parse Error:', e);
                                    console.error('Raw text was:', text);
                                    alert('Server returned invalid data. Check console for details.');
                                    document.getElementById('emptyState').style.display = 'block';
                                }
                            })
                            .catch(error => {
                                console.error('❌ Fetch Error:', error);
                                alert('Failed to load payment history. Please try again.');
                                document.getElementById('emptyState').style.display = 'block';
                            });
                    }

                    // Display member payment history
                    function displayMemberPaymentHistory(data, startDate, endDate) {
                        const memberInfo = data.member_info;
                        const tithes = data.tithes || [];
                        const welfare = data.welfare || [];
                        const summary = data.summary;
                        
                        // Show sections
                        document.getElementById('memberInfoCard').style.display = 'block';
                        document.getElementById('paymentSummaryCards').style.display = 'block';
                        document.getElementById('paymentRecordsTables').style.display = 'block';
                        document.getElementById('emptyState').style.display = 'none';
                        
                        // Update member info
                        const initials = memberInfo.full_name.split(' ').map(n => n[0]).join('').toUpperCase();
                        document.getElementById('memberAvatar').textContent = initials;
                        document.getElementById('memberFullName').textContent = memberInfo.full_name;
                        document.getElementById('memberEmail').textContent = memberInfo.email || 'No email';
                        document.getElementById('memberPhone').textContent = memberInfo.phone || 'No phone';
                        
                        // Update date range display
                        let dateRangeText = 'All Time';
                        if (startDate && endDate) {
                            dateRangeText = `${formatDate(startDate)} - ${formatDate(endDate)}`;
                        } else if (startDate) {
                            dateRangeText = `From ${formatDate(startDate)}`;
                        } else if (endDate) {
                            dateRangeText = `Until ${formatDate(endDate)}`;
                        }
                        document.getElementById('dateRangeDisplay').textContent = dateRangeText;
                        
                        // Update summary cards
                        document.getElementById('totalTithes').textContent = `₵${parseFloat(summary.total_tithes || 0).toFixed(2)}`;
                        document.getElementById('titheCount').textContent = `${summary.tithe_count || 0} transactions`;
                        document.getElementById('totalWelfare').textContent = `₵${parseFloat(summary.total_welfare || 0).toFixed(2)}`;
                        document.getElementById('welfareCount').textContent = `${summary.welfare_count || 0} transactions`;
                        document.getElementById('grandTotal').textContent = `₵${parseFloat(summary.grand_total || 0).toFixed(2)}`;
                        document.getElementById('totalTransactions').textContent = `${summary.total_transactions || 0} total transactions`;
                        
                        // Update tithe table
                        const tithesTableBody = document.getElementById('tithesTableBody');
                        if (tithes.length > 0) {
                            tithesTableBody.innerHTML = tithes.map((tithe, index) => `
                                <tr style="border-bottom: 1px solid #e5e7eb;">
                                    <td style="padding: 12px; color: #6b7280;">${index + 1}</td>
                                    <td style="padding: 12px; color: #374151;">${formatDate(tithe.date)}</td>
                                    <td style="padding: 12px; color: #10b981; font-weight: 600;">₵${parseFloat(tithe.amount).toFixed(2)}</td>
                                    <td style="padding: 12px; color: #374151;">${tithe.payment_method || 'Cash'}</td>
                                    <td style="padding: 12px; color: #6b7280; font-family: monospace;">${tithe.reference_number || 'N/A'}</td>
                                    <td style="padding: 12px; color: #6b7280;">${tithe.notes || '-'}</td>
                                </tr>
                            `).join('');
                        } else {
                            tithesTableBody.innerHTML = '<tr><td colspan="6" style="padding: 40px; text-align: center; color: #9ca3af;">No tithe records found for this period</td></tr>';
                        }
                        
                        // Update welfare table
                        const welfareTableBody = document.getElementById('welfareTableBody');
                        if (welfare.length > 0) {
                            welfareTableBody.innerHTML = welfare.map((item, index) => `
                                <tr style="border-bottom: 1px solid #e5e7eb;">
                                    <td style="padding: 12px; color: #6b7280;">${index + 1}</td>
                                    <td style="padding: 12px; color: #374151;">${formatDate(item.date)}</td>
                                    <td style="padding: 12px; color: #e879f9; font-weight: 600;">₵${parseFloat(item.amount).toFixed(2)}</td>
                                    <td style="padding: 12px; color: #374151;">${item.payment_method || 'Cash'}</td>
                                    <td style="padding: 12px; color: #6b7280; font-family: monospace;">${item.reference_number || 'N/A'}</td>
                                    <td style="padding: 12px; color: #6b7280;">${item.notes || '-'}</td>
                                </tr>
                            `).join('');
                        } else {
                            welfareTableBody.innerHTML = '<tr><td colspan="6" style="padding: 40px; text-align: center; color: #9ca3af;">No welfare records found for this period</td></tr>';
                        }
                    }

                    // Format date helper
                    function formatDate(dateString) {
                        if (!dateString) return 'N/A';
                        const date = new Date(dateString);
                        return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                    }

                    // Export member payments to Excel or PDF
                    function exportMemberPayments(type, format) {
                        const memberId = document.getElementById('selectedMemberId').value;
                        const memberName = document.getElementById('memberSearchInput').value;
                        
                        if (!memberId) {
                            alert('Please search and select a member and load their payment history first');
                            return;
                        }
                        
                        // Get the table based on type
                        const tableId = type === 'tithes' ? 'tithesTable' : 'welfareTable';
                        const table = document.getElementById(tableId);
                        const rows = table.querySelectorAll('tr');
                        
                        if (format === 'excel') {
                            exportToExcel(rows, memberName, type);
                        } else if (format === 'pdf') {
                            exportToPDF(rows, memberName, type);
                        }
                    }
                    
                    // Export to Excel (CSV format)
                    function exportToExcel(rows, memberName, type) {
                        let csv = [];
                        
                        // Add header with member name
                        csv.push(`${type.toUpperCase()} PAYMENT HISTORY - ${memberName}`);
                        csv.push('');
                        
                        // Add table data
                        for (let row of rows) {
                            const cols = row.querySelectorAll('td, th');
                            const csvRow = [];
                            for (let col of cols) {
                                csvRow.push('"' + col.textContent.trim().replace(/"/g, '""') + '"');
                            }
                            csv.push(csvRow.join(','));
                        }
                        
                        // Download CSV
                        const csvContent = csv.join('\n');
                        const blob = new Blob([csvContent], { type: 'text/csv' });
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${memberName}_${type}_${new Date().toISOString().split('T')[0]}.csv`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        
                        console.log(`✅ Exported ${type} to Excel/CSV`);
                    }
                    
                    // Export to PDF
                    function exportToPDF(rows, memberName, type) {
                        // Simple text-based PDF export using print
                        const printWindow = window.open('', '_blank');
                        const memberInfo = {
                            name: document.getElementById('memberFullName').textContent,
                            email: document.getElementById('memberEmail').textContent,
                            phone: document.getElementById('memberPhone').textContent,
                            dateRange: document.getElementById('dateRangeDisplay').textContent
                        };
                        
                        let tableHTML = '<table border="1" cellpadding="8" cellspacing="0" style="width: 100%; border-collapse: collapse; margin-top: 20px;">';
                        for (let row of rows) {
                            tableHTML += '<tr>';
                            const cells = row.querySelectorAll('td, th');
                            for (let cell of cells) {
                                const tag = cell.tagName.toLowerCase();
                                tableHTML += `<${tag} style="border: 1px solid #ddd; padding: 8px; text-align: left;">${cell.textContent}</${tag}>`;
                            }
                            tableHTML += '</tr>';
                        }
                        tableHTML += '</table>';
                        
                        printWindow.document.write(`
                            <!DOCTYPE html>
                            <html>
                            <head>
                                <title>${type.toUpperCase()} Payment History - ${memberName}</title>
                                <style>
                                    body { font-family: Arial, sans-serif; padding: 30px; }
                                    h1 { color: #1e40af; margin-bottom: 10px; }
                                    .header-info { background: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                                    .info-row { margin: 5px 0; }
                                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                                    th { background: #1e40af; color: white; padding: 12px; text-align: left; }
                                    td { padding: 10px; border: 1px solid #ddd; }
                                    .footer { margin-top: 30px; text-align: center; color: #666; font-size: 12px; }
                                    @media print {
                                        button { display: none; }
                                    }
                                </style>
                            </head>
                            <body>
                                <h1>${type.toUpperCase()} Payment History</h1>
                                <div class="header-info">
                                    <div class="info-row"><strong>Member:</strong> ${memberInfo.name}</div>
                                    <div class="info-row"><strong>Email:</strong> ${memberInfo.email}</div>
                                    <div class="info-row"><strong>Phone:</strong> ${memberInfo.phone}</div>
                                    <div class="info-row"><strong>Period:</strong> ${memberInfo.dateRange}</div>
                                    <div class="info-row"><strong>Generated:</strong> ${new Date().toLocaleString()}</div>
                                </div>
                                ${tableHTML}
                                <div class="footer">
                                    <p>Church Management System - Member Payment Report</p>
                                </div>
                                <button onclick="window.print()" style="margin-top: 20px; padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer;">Print / Save as PDF</button>
                            </body>
                            </html>
                        `);
                        printWindow.document.close();
                        
                        console.log(`✅ Opened ${type} PDF preview`);
                    }
                </script>
                
                <!-- Load data loader AFTER all other scripts -->
                <script src="finance_data_loader.js"></script>

            </div>
        </div>
    </div>

    <!-- Custom Date Range Modal -->
    <div id="customDateModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px; margin: 100px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2 style="font-size: 20px; font-weight: 600; color: #1F2937; margin: 0;">Select Custom Date Range</h2>
                <button onclick="closeCustomDateModal()" style="background: none; border: none; font-size: 24px; color: #6B7280; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: all 0.2s;" onmouseover="this.style.background='#F3F4F6'" onmouseout="this.style.background='none'">
                    ×
                </button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label for="customStartDate" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px;">Start Date</label>
                <input type="date" id="customStartDate" style="width: 100%; padding: 10px 14px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 14px; color: #1F2937; transition: all 0.2s;" onfocus="this.style.borderColor='#5B4FDE'; this.style.boxShadow='0 0 0 3px rgba(91, 79, 222, 0.1)'" onblur="this.style.borderColor='#D1D5DB'; this.style.boxShadow='none'">
            </div>
            
            <div style="margin-bottom: 24px;">
                <label for="customEndDate" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px;">End Date</label>
                <input type="date" id="customEndDate" style="width: 100%; padding: 10px 14px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 14px; color: #1F2937; transition: all 0.2s;" onfocus="this.style.borderColor='#5B4FDE'; this.style.boxShadow='0 0 0 3px rgba(91, 79, 222, 0.1)'" onblur="this.style.borderColor='#D1D5DB'; this.style.boxShadow='none'">
            </div>
            
            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <button onclick="closeCustomDateModal()" style="padding: 10px 20px; border: 1px solid #D1D5DB; border-radius: 8px; background: white; color: #374151; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#F9FAFB'" onmouseout="this.style.background='white'">Cancel</button>
                <button onclick="applyCustomDateRange()" style="padding: 10px 20px; border: none; border-radius: 8px; background: #5B4FDE; color: white; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#4C3FCD'" onmouseout="this.style.background='#5B4FDE'">Apply</button>
            </div>
        </div>
    </div>

    <!-- Budget Settings Modal -->
    <div id="budgetSettingsModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px; margin: 100px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2 style="font-size: 20px; font-weight: 600; color: #1F2937; margin: 0;">Set Monthly Budget</h2>
                <button onclick="closeBudgetSettingsModal()" style="background: none; border: none; font-size: 24px; color: #6B7280; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: all 0.2s;" onmouseover="this.style.background='#F3F4F6'" onmouseout="this.style.background='none'">
                    ×
                </button>
            </div>
            
            <p style="color: #6B7280; font-size: 14px; margin-bottom: 20px;">Set the total monthly budget for tracking church expenses. This helps you monitor spending and maintain financial discipline.</p>
            
            <div style="margin-bottom: 20px;">
                <label for="monthlyBudgetInput" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px;">Monthly Budget Amount (₵)</label>
                <input type="number" id="monthlyBudgetInput" min="0" step="0.01" placeholder="50000.00" style="width: 100%; padding: 12px 14px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 16px; color: #1F2937; transition: all 0.2s;" onfocus="this.style.borderColor='#5B4FDE'; this.style.boxShadow='0 0 0 3px rgba(91, 79, 222, 0.1)'" onblur="this.style.borderColor='#D1D5DB'; this.style.boxShadow='none'">
            </div>
            
            <div style="background: #EEF2FF; border-radius: 8px; padding: 12px; margin-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 14px; color: #5B4FDE; font-weight: 500;">
                    <span>Current Budget:</span>
                    <span id="currentBudgetDisplay">₵0.00</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <button onclick="closeBudgetSettingsModal()" style="padding: 10px 20px; border: 1px solid #D1D5DB; border-radius: 8px; background: white; color: #374151; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#F9FAFB'" onmouseout="this.style.background='white'">Cancel</button>
                <button onclick="saveBudgetSettings()" style="padding: 10px 20px; border: none; border-radius: 8px; background: #5B4FDE; color: white; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#4C3FCD'" onmouseout="this.style.background='#5B4FDE'">Save Budget</button>
            </div>
        </div>
    </div>

    <script>
        // Budget Settings Functions
        let currentBudget = 50000; // Default
        
        async function loadBudgetSettings() {
            try {
                const response = await fetch('budget_settings_api.php?action=get_monthly');
                const result = await response.json();

                if (result.success) {
                    currentBudget = parseFloat(result.data.monthly_budget) || 50000;
                    window.currentBudget = currentBudget; // Make it globally accessible
                    // Budget will be updated when expenses are loaded
                }
            } catch (error) {
                console.error('Error loading budget settings:', error);
            }
        }
        
        function openBudgetSettingsModal() {
            document.getElementById('budgetSettingsModal').style.display = 'block';
            document.getElementById('monthlyBudgetInput').value = currentBudget;
            document.getElementById('currentBudgetDisplay').textContent = formatCurrency(currentBudget);
        }
        
        function closeBudgetSettingsModal() {
            document.getElementById('budgetSettingsModal').style.display = 'none';
        }
        
        async function saveBudgetSettings() {
            const budgetInput = document.getElementById('monthlyBudgetInput');
            const newBudget = parseFloat(budgetInput.value);
            
            if (isNaN(newBudget) || newBudget < 0) {
                alert('Please enter a valid budget amount');
                return;
            }
            
            try {
                const response = await fetch('budget_settings_api.php?action=update_monthly', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ amount: newBudget })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentBudget = newBudget;
                    window.currentBudget = newBudget; // Update global variable
                    closeBudgetSettingsModal();
                    alert('Budget updated successfully!');
                    // Update budget display and reload expenses
                    loadExpenses(); // Reload expenses section
                    loadFinancialStats(); // Update expenses and budget remaining
                } else {
                    alert('Error: ' + (result.message || 'Failed to update budget'));
                }
            } catch (error) {
                console.error('Error saving budget:', error);
                alert('Failed to save budget settings');
            }
        }

        // Load CPS Contributors with action buttons
        function loadCPSContributors() {
            fetch('get_finance_data.php?type=tithes&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data) {
                        const tbody = document.getElementById('cpsContributorsList');
                        tbody.innerHTML = '';

                        // Update metrics
                        const summary = result.data.summary;
                        const cpsAmountElements = document.querySelectorAll('#cpsContent .cps-amount');
                        if (cpsAmountElements.length >= 3) {
                            cpsAmountElements[0].textContent = summary.unique_members || 0;
                            cpsAmountElements[1].textContent = '₵' + parseFloat(summary.total_amount || 0).toFixed(2);
                            cpsAmountElements[2].textContent = '₵' + parseFloat(summary.avg_amount || 0).toFixed(2);
                        }

                        // Populate table rows
                        if (result.data.tithes && result.data.tithes.length > 0) {
                            result.data.tithes.forEach(tithe => {
                                const initials = tithe.member_name ? tithe.member_name.split(' ').map(n => n[0]).join('').toUpperCase() : 'NA';

                                // Generate avatar HTML - use photo if available, otherwise use initials
                                let avatarHTML;
                                if (tithe.member_photo && tithe.member_photo.trim() !== '') {
                                    avatarHTML = `<img src="../Add_Members/${tithe.member_photo}" alt="${tithe.member_name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                                } else {
                                    avatarHTML = initials;
                                }

                                const row = `
                                    <tr class="borp_cpsrow">
                                        <td><input type="checkbox" class="member-checkbox"></td>
                                        <td>
                                            <div class="borp_meminfo">
                                                <div class="borp_memavatar">${avatarHTML}</div>
                                                <div>
                                                    <div class="borp_memname">${tithe.member_name || 'Unknown'}</div>
                                                    <div class="borp_mememail">${tithe.member_email || ''}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="borp_amtcell">₵${parseFloat(tithe.amount).toFixed(2)}</td>
                                        <td>${new Date(tithe.date).toLocaleDateString()}</td>
                                        <td><span class="borp_paymeth">${tithe.payment_method || 'Cash'}</span></td>
                                        <td><span class="borp_statbadge borp_statpaid">Paid</span></td>
                                        <td>
                                            <div class="gorp_actbtns">
                                                <button class="borp_acticon" onclick="viewCPSReceipt('${tithe.transaction_id}')" title="View">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                        <circle cx="12" cy="12" r="3"></circle>
                                                    </svg>
                                                </button>
                                                <button class="borp_acticon" onclick="editCPS('${tithe.transaction_id}')" title="Edit">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                                    </svg>
                                                </button>
                                                <button class="borp_acticon gorp_delbtn" onclick="deleteCPS('${tithe.transaction_id}', event)" title="Delete">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="3 6 5 6 21 6"></polyline>
                                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                                tbody.innerHTML += row;
                            });
                        }
                    }
                })
                .catch(error => console.error('Error loading CPS contributors:', error));
        }

        // Load Welfare Contributors with action buttons
        function loadWelfareContributors() {
            fetch('get_finance_data.php?type=welfare&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data) {
                        const tbody = document.getElementById('welfareContributorsList');
                        tbody.innerHTML = '';

                        // Update metrics
                        const summary = result.data.summary;
                        const welfareAmountElements = document.querySelectorAll('#welfareContent .cps-amount');
                        if (welfareAmountElements.length >= 3) {
                            welfareAmountElements[0].textContent = summary.unique_members || 0;
                            welfareAmountElements[1].textContent = '₵' + parseFloat(summary.total_amount || 0).toFixed(2);
                            welfareAmountElements[2].textContent = '₵' + parseFloat(summary.avg_amount || 0).toFixed(2);
                        }

                        // Populate table rows
                        if (result.data.welfare && result.data.welfare.length > 0) {
                            result.data.welfare.forEach(welfare => {
                                const initials = welfare.member_name ? welfare.member_name.split(' ').map(n => n[0]).join('').toUpperCase() : 'NA';

                                // Generate avatar HTML - use photo if available, otherwise use initials
                                let avatarHTML;
                                if (welfare.member_photo && welfare.member_photo.trim() !== '') {
                                    avatarHTML = `<img src="../Add_Members/${welfare.member_photo}" alt="${welfare.member_name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                                } else {
                                    avatarHTML = initials;
                                }

                                const row = `
                                    <tr class="borp_cpsrow">
                                        <td><input type="checkbox" class="member-checkbox"></td>
                                        <td>
                                            <div class="borp_meminfo">
                                                <div class="borp_memavatar">${avatarHTML}</div>
                                                <div>
                                                    <div class="borp_memname">${welfare.member_name || 'Unknown'}</div>
                                                    <div class="borp_mememail">${welfare.member_email || ''}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="borp_amtcell">₵${parseFloat(welfare.amount).toFixed(2)}</td>
                                        <td>${new Date(welfare.date).toLocaleDateString()}</td>
                                        <td><span class="borp_paymeth">${welfare.payment_method || 'Cash'}</span></td>
                                        <td><span class="borp_statbadge borp_statpaid">Paid</span></td>
                                        <td>
                                            <div class="gorp_actbtns">
                                                <button class="borp_acticon" onclick="viewWelfareReceipt('${welfare.transaction_id}')" title="View">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                        <circle cx="12" cy="12" r="3"></circle>
                                                    </svg>
                                                </button>
                                                <button class="borp_acticon" onclick="editWelfare('${welfare.transaction_id}')" title="Edit">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                                    </svg>
                                                </button>
                                                <button class="borp_acticon gorp_delbtn" onclick="deleteWelfare('${welfare.transaction_id}', event)" title="Delete">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="3 6 5 6 21 6"></polyline>
                                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                                tbody.innerHTML += row;
                            });
                        }
                    }
                })
                .catch(error => console.error('Error loading welfare contributors:', error));
        }

        // Load Expenses with action buttons
        function loadExpenses() {
            fetch('get_finance_data.php?type=expenses&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data) {
                        const tbody = document.getElementById('expensesList');
                        tbody.innerHTML = '';

                        // Update expense metrics/summary
                        if (result.data.summary) {
                            const summary = result.data.summary;

                            // Total Expenses
                            const totalExpensesElem = document.getElementById('totalExpensesAmount');
                            if (totalExpensesElem) {
                                totalExpensesElem.textContent = '₵' + parseFloat(summary.total_amount || 0).toFixed(2);
                            }

                            // Pending Count
                            const pendingCountElem = document.getElementById('pendingCount');
                            if (pendingCountElem) {
                                pendingCountElem.textContent = summary.pending_count || 0;
                            }

                            // Largest Category
                            if (result.data.categories && result.data.categories.length > 0) {
                                const largest = result.data.categories[0];
                                const largestCategoryElem = document.getElementById('largestCategory');
                                const largestCategoryValueElem = document.getElementById('largestCategoryValue');

                                if (largestCategoryElem) {
                                    largestCategoryElem.textContent = largest.category || 'None';
                                }

                                if (largestCategoryValueElem && summary.total_amount > 0) {
                                    const percentage = ((parseFloat(largest.total) / parseFloat(summary.total_amount)) * 100).toFixed(1);
                                    largestCategoryValueElem.textContent = `₵${parseFloat(largest.total).toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }

                        // Populate expense rows
                        if (result.data.expenses && result.data.expenses.length > 0) {
                            result.data.expenses.forEach(expense => {
                            const categoryClass = {
                                'utilities': 'forp_catutil',
                                'maintenance': 'forp_catmaint',
                                'salaries': 'forp_catsal',
                                'supplies': 'forp_catsup',
                                'events': 'forp_catev',
                                'transportation': 'forp_cattrans',
                                'other': 'forp_catother'
                            }[expense.category.toLowerCase()] || 'forp_catother';

                            const statusClass = {
                                'approved': 'forp_statapp',
                                'pending': 'forp_statpen',
                                'rejected': 'forp_statsrej'
                            }[expense.status.toLowerCase()] || 'forp_statpen';

                            const row = `
                                <tr class="eorp_exprow" data-category="${expense.category.toLowerCase()}" data-status="${expense.status.toLowerCase()}">
                                    <td>${new Date(expense.date).toLocaleDateString()}</td>
                                    <td>
                                        <div class="eorp_expdesc">
                                            <div class="eorp_exptit">${expense.description}</div>
                                            <div class="eorp_expnote">${expense.notes || ''}</div>
                                        </div>
                                    </td>
                                    <td><span class="forp_cattag ${categoryClass}">${expense.category}</span></td>
                                    <td>${expense.vendor_payee || 'N/A'}</td>
                                    <td class="wump_amtneg">₵${parseFloat(expense.amount).toFixed(2)}</td>
                                    <td><span class="borp_paymeth">${expense.payment_method || 'Cash'}</span></td>
                                    <td><span class="borp_statbadge ${statusClass}">${expense.status}</span></td>
                                    <td>
                                        <button class="gorp_receiptbtn" onclick="viewReceipt('${expense.transaction_id}')" title="View Receipt">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                                <polyline points="14 2 14 8 20 8"></polyline>
                                            </svg>
                                        </button>
                                    </td>
                                    <td>
                                        <div class="gorp_actbtns">
                                            <button class="borp_acticon" onclick="editExpense('${expense.transaction_id}')" title="Edit">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                                </svg>
                                            </button>
                                            <button class="borp_acticon gorp_delbtn" onclick="deleteExpense('${expense.transaction_id}', event)" title="Delete">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <polyline points="3 6 5 6 21 6"></polyline>
                                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                            tbody.innerHTML += row;
                        });
                        }
                    }
                })
                .catch(error => console.error('Error loading expenses:', error));
        }

        // Load Financial Stats - Top overview cards (ONLY EXPENSES UPDATES ON CHANGES)
        function loadFinancialStats() {
            // ONLY load and update Expenses - other sections load on page load only
            fetch('get_finance_data.php?type=expenses&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const total = parseFloat(result.data.summary.total_amount || 0);
                        document.getElementById('topExpensesTotal').textContent = '₵' + total.toFixed(2);
                        updatePercentageChange('topExpensesChange', result.data.summary.percent_change);

                        // Update Budget Remaining
                        const budgetElem = document.getElementById('budgetRemaining');
                        const budgetTotalElem = document.getElementById('budgetTotal');

                        if (budgetElem && window.currentBudget) {
                            const remaining = window.currentBudget - total;
                            budgetElem.textContent = '₵' + remaining.toFixed(2);

                            // Update the "Out of" text
                            if (budgetTotalElem) {
                                budgetTotalElem.textContent = 'Out of ₵' + window.currentBudget.toFixed(2);
                            }

                            // Update progress bar
                            const budgetProgress = document.getElementById('budgetProgress');
                            if (budgetProgress) {
                                const percentage = window.currentBudget > 0 ? ((total / window.currentBudget) * 100) : 0;
                                budgetProgress.style.width = Math.min(percentage, 100) + '%';
                            }
                        }
                    }
                })
                .catch(error => console.error('Error loading expenses stats:', error));
        }

        // Update Offerings Summary Cards
        function updateOfferingsSummary() {
            fetch('get_finance_data.php?type=offerings&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const summary = result.data.summary;
                        // Update month total
                        document.getElementById('offeringsMonthAmount').textContent = '₵' + parseFloat(summary.total_amount || 0).toFixed(2);
                        const avgPerService = summary.count > 0 ? (parseFloat(summary.total_amount || 0) / summary.count) : 0;
                        document.getElementById('offeringsMonthMeta').textContent = `Average: ₵${avgPerService.toFixed(2)}/service`;
                    }
                })
                .catch(error => console.error('Error updating offerings summary:', error));

            // Update today's offerings
            fetch('get_finance_data.php?type=offerings&range=today')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const summary = result.data.summary;
                        document.getElementById('offeringsTodayAmount').textContent = '₵' + parseFloat(summary.total_amount || 0).toFixed(2);
                        document.getElementById('offeringsTodayMeta').textContent = `${summary.count || 0} services recorded`;
                    }
                })
                .catch(error => console.error('Error updating today offerings:', error));

            // Update this week
            fetch('get_finance_data.php?type=offerings&range=week')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const summary = result.data.summary;
                        document.getElementById('offeringsWeekAmount').textContent = '₵' + parseFloat(summary.total_amount || 0).toFixed(2);
                        const change = parseFloat(summary.percent_change || 0);
                        const sign = change >= 0 ? '↑' : '↓';
                        document.getElementById('offeringsWeekMeta').textContent = `${sign} ${Math.abs(change).toFixed(1)}% from last week`;
                    }
                })
                .catch(error => console.error('Error updating week offerings:', error));
        }

        // Update Project Offerings Summary Cards
        function updateProjectOfferingsSummary() {
            fetch('get_finance_data.php?type=project_offerings&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const summary = result.data.summary;
                        document.getElementById('projectOfferingsMonthAmount').textContent = '₵' + parseFloat(summary.total_amount || 0).toFixed(2);
                        const avgPerProject = summary.count > 0 ? (parseFloat(summary.total_amount || 0) / summary.count) : 0;
                        document.getElementById('projectOfferingsMonthMeta').textContent = `Average: ₵${avgPerProject.toFixed(2)}/project`;
                    }
                })
                .catch(error => console.error('Error updating project offerings summary:', error));

            // Update today's project offerings
            fetch('get_finance_data.php?type=project_offerings&range=today')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const summary = result.data.summary;
                        document.getElementById('projectOfferingsTodayAmount').textContent = '₵' + parseFloat(summary.total_amount || 0).toFixed(2);
                        document.getElementById('projectOfferingsTodayMeta').textContent = `${summary.count || 0} projects recorded`;
                    }
                })
                .catch(error => console.error('Error updating today project offerings:', error));

            // Update this week
            fetch('get_finance_data.php?type=project_offerings&range=week')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const summary = result.data.summary;
                        document.getElementById('projectOfferingsWeekAmount').textContent = '₵' + parseFloat(summary.total_amount || 0).toFixed(2);
                        const change = parseFloat(summary.percent_change || 0);
                        const sign = change >= 0 ? '↑' : '↓';
                        document.getElementById('projectOfferingsWeekMeta').textContent = `${sign} ${Math.abs(change).toFixed(1)}% from last week`;
                    }
                })
                .catch(error => console.error('Error updating week project offerings:', error));
        }

        // Load ALL top stats on page load ONCE
        function loadAllTopStats() {
            // Load Offerings
            fetch('get_finance_data.php?type=offerings&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const total = parseFloat(result.data.summary.total_amount || 0);
                        document.getElementById('topOfferingsTotal').textContent = '₵' + total.toFixed(2);
                        updatePercentageChange('topOfferingsChange', result.data.summary.percent_change);
                    }
                })
                .catch(error => console.error('Error loading offerings stats:', error));

            // Load Tithes/CPS
            fetch('get_finance_data.php?type=tithes&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const total = parseFloat(result.data.summary.total_amount || 0);
                        document.getElementById('topTithesTotal').textContent = '₵' + total.toFixed(2);
                        updatePercentageChange('topTithesChange', result.data.summary.percent_change);
                    }
                })
                .catch(error => console.error('Error loading tithes stats:', error));

            // Load Project Offerings
            fetch('get_finance_data.php?type=project_offerings&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const total = parseFloat(result.data.summary.total_amount || 0);
                        document.getElementById('topProjectOfferingsTotal').textContent = '₵' + total.toFixed(2);
                        updatePercentageChange('topProjectOfferingsChange', result.data.summary.percent_change);
                    }
                })
                .catch(error => console.error('Error loading project offerings stats:', error));

            // Load Welfare
            fetch('get_finance_data.php?type=welfare&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const total = parseFloat(result.data.summary.total_amount || 0);
                        document.getElementById('topWelfareTotal').textContent = '₵' + total.toFixed(2);
                        updatePercentageChange('topWelfareChange', result.data.summary.percent_change);
                    }
                })
                .catch(error => console.error('Error loading welfare stats:', error));

            // Load Expenses (same as loadFinancialStats but called once on page load)
            loadFinancialStats();
        }

        function updatePercentageChange(elementId, percentChange) {
            const elem = document.getElementById(elementId);
            if (elem) {
                const change = parseFloat(percentChange || 0);
                const sign = change >= 0 ? '+' : '';
                elem.textContent = `${sign}${change.toFixed(1)}% from last month`;
                elem.className = 'zzamp_statchg ' + (change >= 0 ? 'positive' : 'negative');
            }
        }

        // Update Top Offerings Stat
        function updateTopOfferingsStat() {
            fetch('get_finance_data.php?type=offerings&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const total = parseFloat(result.data.summary.total_amount || 0);
                        document.getElementById('topOfferingsTotal').textContent = '₵' + total.toFixed(2);
                        updatePercentageChange('topOfferingsChange', result.data.summary.percent_change);
                    }
                })
                .catch(error => console.error('Error loading offerings stats:', error));
        }

        // Update Top Tithes/CPS Stat
        function updateTopTithesStat() {
            fetch('get_finance_data.php?type=tithes&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const total = parseFloat(result.data.summary.total_amount || 0);
                        document.getElementById('topTithesTotal').textContent = '₵' + total.toFixed(2);
                        updatePercentageChange('topTithesChange', result.data.summary.percent_change);
                    }
                })
                .catch(error => console.error('Error loading tithes stats:', error));
        }

        // Update Top Project Offerings Stat
        function updateTopProjectOfferingsStat() {
            fetch('get_finance_data.php?type=project_offerings&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const total = parseFloat(result.data.summary.total_amount || 0);
                        document.getElementById('topProjectOfferingsTotal').textContent = '₵' + total.toFixed(2);
                        updatePercentageChange('topProjectOfferingsChange', result.data.summary.percent_change);
                    }
                })
                .catch(error => console.error('Error loading project offerings stats:', error));
        }

        // Update Top Welfare Stat
        function updateTopWelfareStat() {
            fetch('get_finance_data.php?type=welfare&range=month')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data?.summary) {
                        const total = parseFloat(result.data.summary.total_amount || 0);
                        document.getElementById('topWelfareTotal').textContent = '₵' + total.toFixed(2);
                        updatePercentageChange('topWelfareChange', result.data.summary.percent_change);
                    }
                })
                .catch(error => console.error('Error loading welfare stats:', error));
        }

        // Update Finance Categories Pie Chart
        function updateFinanceCategoriesChart() {
            // Fetch data for all categories for the current month
            Promise.all([
                fetch('get_finance_data.php?type=tithes&range=month').then(r => r.json()),
                fetch('get_finance_data.php?type=welfare&range=month').then(r => r.json()),
                fetch('get_finance_data.php?type=project_offerings&range=month').then(r => r.json()),
                fetch('get_finance_data.php?type=offerings&range=month').then(r => r.json())
            ])
            .then(results => {
                const titheTotal = results[0].success ? parseFloat(results[0].data?.summary?.total_amount || 0) : 0;
                const welfareTotal = results[1].success ? parseFloat(results[1].data?.summary?.total_amount || 0) : 0;
                const projectTotal = results[2].success ? parseFloat(results[2].data?.summary?.total_amount || 0) : 0;
                const offeringTotal = results[3].success ? parseFloat(results[3].data?.summary?.total_amount || 0) : 0;

                const total = titheTotal + welfareTotal + projectTotal + offeringTotal;

                // Calculate percentages
                const tithePercent = total > 0 ? ((titheTotal / total) * 100).toFixed(1) : 0;
                const welfarePercent = total > 0 ? ((welfareTotal / total) * 100).toFixed(1) : 0;
                const projectPercent = total > 0 ? ((projectTotal / total) * 100).toFixed(1) : 0;
                const offeringPercent = total > 0 ? ((offeringTotal / total) * 100).toFixed(1) : 0;
                const otherPercent = 0; // Placeholder for other categories

                // Update the chart
                if (window.categoriesChart) {
                    window.categoriesChart.data.datasets[0].data = [
                        parseFloat(tithePercent),
                        parseFloat(welfarePercent),
                        parseFloat(projectPercent),
                        parseFloat(offeringPercent),
                        parseFloat(otherPercent)
                    ];
                    window.categoriesChart.update();
                }
            })
            .catch(error => console.error('Error updating finance categories chart:', error));
        }

        // Update Financial Trends Line Chart (6 months)
        function updateFinancialTrendsChart() {
            // Fetch 6 months of data for income and expenses
            fetch('get_finance_data.php?type=financial_trends&months=6')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data) {
                        // Update the chartData object used by tooltips
                        window.chartData = {};

                        result.data.forEach(monthData => {
                            window.chartData[monthData.month] = {
                                income: '₵' + parseFloat(monthData.income || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}),
                                expenses: '₵' + parseFloat(monthData.expenses || 0).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})
                            };
                        });

                        // Update the SVG chart dots and lines
                        updateLineChartVisuals(result.data);

                        // Update Y-axis labels with real values in Cedis
                        updateYAxisLabels(result.data);

                        // Update X-axis month labels
                        updateXAxisLabels(result.data);
                    }
                })
                .catch(error => console.error('Error updating financial trends chart:', error));
        }

        // Helper function to update the line chart SVG visuals
        function updateLineChartVisuals(data) {
            // Find max value for scaling
            const allValues = [];
            data.forEach(month => {
                allValues.push(parseFloat(month.income || 0));
                allValues.push(parseFloat(month.expenses || 0));
            });
            const maxValue = Math.max(...allValues, 100); // Minimum 100 to avoid division by zero
            const chartHeight = 250; // SVG chart height in pixels
            const chartPadding = 30; // Padding from top/bottom

            // Fixed X positions for 6 months
            const xPositions = [150, 250, 350, 450, 550, 650];

            // Calculate positions for income and expense lines
            const incomePoints = [];
            const expensePoints = [];

            data.forEach((month, index) => {
                if (index < xPositions.length) {
                    const x = xPositions[index];
                    // Calculate Y position (inverted because SVG y increases downward)
                    const incomeY = chartHeight - ((parseFloat(month.income || 0) / maxValue) * (chartHeight - chartPadding)) + 20;
                    const expenseY = chartHeight - ((parseFloat(month.expenses || 0) / maxValue) * (chartHeight - chartPadding)) + 20;

                    incomePoints.push(`${x},${incomeY}`);
                    expensePoints.push(`${x},${expenseY}`);
                }
            });

            // Update income line (polyline with stroke="#10B981")
            const incomeLine = document.querySelector('.vorp_chartsvg polyline[stroke="#10B981"]');
            if (incomeLine) {
                incomeLine.setAttribute('points', incomePoints.join(' '));
            }

            // Update expense line (polyline with stroke="#EF4444")
            const expenseLine = document.querySelector('.vorp_chartsvg polyline[stroke="#EF4444"]');
            if (expenseLine) {
                expenseLine.setAttribute('points', expensePoints.join(' '));
            }

            // Update dots for income (green dots)
            const incomeDots = document.querySelectorAll('.vorp_dot[stroke="#10B981"]');
            incomeDots.forEach((dot, index) => {
                if (incomePoints[index]) {
                    const [cx, cy] = incomePoints[index].split(',');
                    dot.setAttribute('cx', cx);
                    dot.setAttribute('cy', cy);
                    dot.setAttribute('data-month', data[index].month);
                }
            });

            // Update dots for expenses (red dots)
            const expenseDots = document.querySelectorAll('.vorp_dot[stroke="#EF4444"]');
            expenseDots.forEach((dot, index) => {
                if (expensePoints[index]) {
                    const [cx, cy] = expensePoints[index].split(',');
                    dot.setAttribute('cx', cx);
                    dot.setAttribute('cy', cy);
                    dot.setAttribute('data-month', data[index].month);
                }
            });
        }

        // Helper function to update Y-axis labels with real values in Cedis
        function updateYAxisLabels(data) {
            // Find max value for scaling
            const allValues = [];
            data.forEach(month => {
                allValues.push(parseFloat(month.income || 0));
                allValues.push(parseFloat(month.expenses || 0));
            });
            const maxValue = Math.max(...allValues, 1);

            // Calculate nice rounded intervals for Y-axis
            const intervals = 5; // Number of Y-axis labels
            const step = Math.ceil(maxValue / intervals / 1000) * 1000; // Round to nearest 1000

            // Update Y-axis text labels
            const yAxisLabels = document.querySelectorAll('.vorp_chartsvg text[x="40"]');
            yAxisLabels.forEach((label, index) => {
                const value = (intervals - index) * step;
                const formattedValue = value >= 1000 ? '₵' + (value / 1000).toFixed(0) + 'k' : '₵' + value.toFixed(0);
                label.textContent = formattedValue;
            });
        }

        // Helper function to update X-axis month labels
        function updateXAxisLabels(data) {
            // Update X-axis month text labels
            const xAxisLabels = document.querySelectorAll('.vorp_chartsvg text[y="285"]');
            xAxisLabels.forEach((label, index) => {
                if (data[index]) {
                    label.textContent = data[index].month;
                }
            });
        }

        // Load budget settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAllTopStats(); // Load all top stats ONCE on page load
            loadBudgetSettings();
            loadCPSContributors();
            loadWelfareContributors();
            loadExpenses();
            updateOfferingsSummary(); // Load offerings metrics on page load
            updateProjectOfferingsSummary(); // Load project offerings metrics on page load
            updateFinanceCategoriesChart(); // Load finance categories pie chart
            updateFinancialTrendsChart(); // Load financial trends line chart
        });
    </script>

    <style>
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            backdrop-filter: blur(4px);
        }
    </style>

</body>

</html>
